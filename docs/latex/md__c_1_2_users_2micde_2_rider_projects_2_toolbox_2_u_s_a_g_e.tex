\chapter{Toolbox Usage Guide }
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e}{}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e}\index{Toolbox Usage Guide@{Toolbox Usage Guide}}
\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md46}%
\Hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md46}%


This guide provides detailed instructions for using the Toolbox library.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md47}{}\doxysection{\texorpdfstring{Table of Contents}{Table of Contents}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md47}

\begin{DoxyEnumerate}
\item Getting Started
\item Cryptography Services
\begin{DoxyItemize}
\item Base64 Encoding
\item AES Encryption
\item RSA Encryption
\end{DoxyItemize}
\item File Transfer Services
\begin{DoxyItemize}
\item FTP/\+\+FTPS
\item SFTP
\end{DoxyItemize}
\item Mailing Services
\item API Services
\item LDAP Services
\begin{DoxyItemize}
\item Active Directory
\item Azure AD /\+ Entra ID
\item Open\+LDAP
\item Apple Directory
\item Advanced Authentication
\end{DoxyItemize}
\item SSO Services
\begin{DoxyItemize}
\item Session Management
\item Credential Storage
\item Automatic Token Refresh
\end{DoxyItemize}
\item Creating Custom Services
\item Open\+Telemetry Integration
\item Configuration Options
\item Best Practices
\end{DoxyEnumerate}\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md48}{}\doxysection{\texorpdfstring{Getting Started}{Getting Started}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md48}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md49}{}\doxysubsection{\texorpdfstring{Basic Setup}{Basic Setup}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md49}
Add Toolbox to your application:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{}
\DoxyCodeLine{var\ builder\ =\ Host.CreateApplicationBuilder(args);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Register\ Toolbox\ core\ services}}
\DoxyCodeLine{builder.Services.AddToolboxCore();}
\DoxyCodeLine{}
\DoxyCodeLine{var\ app\ =\ builder.Build();}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md50}{}\doxysubsection{\texorpdfstring{Configuration via appsettings.\+json}{Configuration via appsettings.\+json}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md50}

\begin{DoxyCode}{0}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ "{}Toolbox"{}:\ \{}
\DoxyCodeLine{\ \ \ \ "{}EnableDetailedTelemetry"{}:\ false,}
\DoxyCodeLine{\ \ \ \ "{}ServicePrefix"{}:\ "{}MyApp"{},}
\DoxyCodeLine{\ \ \ \ "{}AsyncDisposalTimeout"{}:\ "{}00:00:30"{}}
\DoxyCodeLine{\ \ \},}
\DoxyCodeLine{\ \ "{}Toolbox:Telemetry"{}:\ \{}
\DoxyCodeLine{\ \ \ \ "{}EnableTracing"{}:\ true,}
\DoxyCodeLine{\ \ \ \ "{}EnableMetrics"{}:\ true,}
\DoxyCodeLine{\ \ \ \ "{}EnableConsoleExport"{}:\ false,}
\DoxyCodeLine{\ \ \ \ "{}ServiceName"{}:\ "{}MyApplication"{},}
\DoxyCodeLine{\ \ \ \ "{}ServiceVersion"{}:\ "{}1.0.0"{}}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{builder.Services.AddToolboxCore(builder.Configuration);}
\DoxyCodeLine{builder.Services.AddToolboxOpenTelemetry(builder.Configuration);}

\end{DoxyCode}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md52}{}\doxysection{\texorpdfstring{Cryptography Services}{Cryptography Services}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md52}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md53}{}\doxysubsection{\texorpdfstring{Base64 Encoding}{Base64 Encoding}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md53}
Base64 encoding/\+decoding service for text obfuscation (not encryption).\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md54}{}\doxysubsubsection{\texorpdfstring{Registration}{Registration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md54}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Standard\ Base64}}
\DoxyCodeLine{services.AddBase64Cryptography();}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ URL-\/safe\ Base64}}
\DoxyCodeLine{services.AddBase64Cryptography(Base64EncodingTable.UrlSafe);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ With\ full\ options}}
\DoxyCodeLine{services.AddBase64Cryptography(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.EncodingTable\ =\ Base64EncodingTable.UrlSafe;}
\DoxyCodeLine{\ \ \ \ options.IncludePadding\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\});}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md55}{}\doxysubsubsection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md55}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }MyService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ICryptographyService\ \_crypto;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ MyService(ICryptographyService\ crypto)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_crypto\ =\ crypto;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ ProcessAsync()}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Encode}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ encoded\ =\ \_crypto.Encrypt(\textcolor{stringliteral}{"{}Hello,\ World!"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Result:\ "{}SGVsbG8sIFdvcmxkIQ=="{}}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Decode}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ decoded\ =\ \_crypto.Decrypt(encoded);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Result:\ "{}Hello,\ World!"{}}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Async\ versions}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ encodedAsync\ =\ await\ \_crypto.EncryptAsync(\textcolor{stringliteral}{"{}Hello"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ decodedAsync\ =\ await\ \_crypto.DecryptAsync(encodedAsync);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md57}{}\doxysubsection{\texorpdfstring{AES Encryption}{AES Encryption}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md57}
Secure symmetric encryption using AES (CBC mode with PKCS7 padding).\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md58}{}\doxysubsubsection{\texorpdfstring{Registration}{Registration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md58}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Generate\ new\ key\ and\ IV}}
\DoxyCodeLine{var\ (key,\ iv)\ =\ AesCryptographyService.GenerateKey(AesKeySize.Aes256);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Register\ with\ generated\ key}}
\DoxyCodeLine{services.AddAesCryptography(key,\ iv);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Or\ with\ key\ size\ enum}}
\DoxyCodeLine{services.AddAesCryptography(AesKeySize.Aes256);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md59}{}\doxysubsubsection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md59}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }SecureService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ICryptographyService\ \_crypto;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ SecureService(ICryptographyService\ crypto)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_crypto\ =\ crypto;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<string>\ EncryptDataAsync(\textcolor{keywordtype}{string}\ sensitiveData)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Encrypt\ (returns\ Base64-\/encoded\ ciphertext)}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ encrypted\ =\ await\ \_crypto.EncryptAsync(sensitiveData);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Decrypt}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ decrypted\ =\ await\ \_crypto.DecryptAsync(encrypted);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ encrypted;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md60}{}\doxysubsubsection{\texorpdfstring{Key Generation}{Key Generation}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md60}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Generate\ AES-\/128\ key}}
\DoxyCodeLine{var\ (key128,\ iv128)\ =\ AesCryptographyService.GenerateKey(AesKeySize.Aes128);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Generate\ AES-\/192\ key}}
\DoxyCodeLine{var\ (key192,\ iv192)\ =\ AesCryptographyService.GenerateKey(AesKeySize.Aes192);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Generate\ AES-\/256\ key\ (recommended)}}
\DoxyCodeLine{var\ (key256,\ iv256)\ =\ AesCryptographyService.GenerateKey(AesKeySize.Aes256);}

\end{DoxyCode}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md62}{}\doxysubsection{\texorpdfstring{RSA Encryption}{RSA Encryption}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md62}
Asymmetric encryption using RSA with various key sizes and padding modes.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md63}{}\doxysubsubsection{\texorpdfstring{Registration}{Registration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md63}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Generate\ key\ pair}}
\DoxyCodeLine{var\ keyPair\ =\ RsaCryptographyService.GenerateKeyPair(RsaKeySize.Rsa2048);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Register\ with\ full\ key\ pair\ (encrypt\ +\ decrypt)}}
\DoxyCodeLine{services.AddRsaCryptography(}
\DoxyCodeLine{\ \ \ \ keyPair.PublicKey!,}
\DoxyCodeLine{\ \ \ \ RsaPaddingMode.OaepSha256,}
\DoxyCodeLine{\ \ \ \ keyPair.PrivateKey);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Register\ with\ public\ key\ only\ (encrypt\ only)}}
\DoxyCodeLine{services.AddRsaCryptography(}
\DoxyCodeLine{\ \ \ \ keyPair.PublicKey!,}
\DoxyCodeLine{\ \ \ \ RsaPaddingMode.OaepSha256);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Register\ with\ X.509\ certificate}}
\DoxyCodeLine{var\ cert\ =\ \textcolor{keyword}{new}\ X509Certificate2(\textcolor{stringliteral}{"{}certificate.pfx"{}},\ \textcolor{stringliteral}{"{}password"{}});}
\DoxyCodeLine{services.AddRsaCryptography(cert,\ RsaPaddingMode.OaepSha256);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md64}{}\doxysubsubsection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md64}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }AsymmetricService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ICryptographyService\ \_crypto;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ AsymmetricService(ICryptographyService\ crypto)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_crypto\ =\ crypto;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<(\textcolor{keywordtype}{string}\ encrypted,\ \textcolor{keywordtype}{string}\ decrypted)>\ ProcessAsync(\textcolor{keywordtype}{string}\ data)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Encrypt\ with\ public\ key}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ encrypted\ =\ await\ \_crypto.EncryptAsync(data);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Decrypt\ with\ private\ key\ (requires\ private\ key)}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ decrypted\ =\ await\ \_crypto.DecryptAsync(encrypted);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (encrypted,\ decrypted);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md65}{}\doxysubsubsection{\texorpdfstring{Key Generation}{Key Generation}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md65}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Generate\ key\ pair\ (bytes)}}
\DoxyCodeLine{var\ keyPair\ =\ RsaCryptographyService.GenerateKeyPair(RsaKeySize.Rsa2048);}
\DoxyCodeLine{\textcolor{keywordtype}{byte}[]\ publicKey\ =\ keyPair.PublicKey!;}
\DoxyCodeLine{\textcolor{keywordtype}{byte}[]\ privateKey\ =\ keyPair.PrivateKey!;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Generate\ self-\/signed\ certificate}}
\DoxyCodeLine{var\ certKeyPair\ =\ RsaCryptographyService.GenerateCertificate(}
\DoxyCodeLine{\ \ \ \ RsaKeySize.Rsa4096,}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}CN=MyApplication"{}},}
\DoxyCodeLine{\ \ \ \ TimeSpan.FromDays(365));}
\DoxyCodeLine{X509Certificate2\ certificate\ =\ certKeyPair.Certificate!;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Public\ key\ only\ (for\ sharing)}}
\DoxyCodeLine{var\ publicOnly\ =\ RsaCryptographyService.GenerateKeyPair(}
\DoxyCodeLine{\ \ \ \ RsaKeySize.Rsa2048,}
\DoxyCodeLine{\ \ \ \ includePrivateKey:\ \textcolor{keyword}{false});}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md66}{}\doxysubsubsection{\texorpdfstring{Padding Modes}{Padding Modes}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md66}

\begin{DoxyTable}{2}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Mode  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Pkcs1}  &PKCS\#1 v1.\+5 padding (legacy)  \\
{\ttfamily Oaep\+Sha1}  &OAEP with SHA-\/1  \\
{\ttfamily Oaep\+Sha256}  &OAEP with SHA-\/256 (recommended)  \\
{\ttfamily Oaep\+Sha384}  &OAEP with SHA-\/384  \\
{\ttfamily Oaep\+Sha512}  &OAEP with SHA-\/512  \\
\end{DoxyTable}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md68}{}\doxysection{\texorpdfstring{File Transfer Services}{File Transfer Services}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md68}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md69}{}\doxysubsection{\texorpdfstring{FTP/\+\+FTPS}{FTP/\+\+FTPS}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md69}
File transfer service for FTP and FTPS (FTP over TLS) protocols.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md70}{}\doxysubsubsection{\texorpdfstring{Registration}{Registration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md70}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Basic\ FTP}}
\DoxyCodeLine{services.AddFtpFileTransfer(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.Host\ =\ \textcolor{stringliteral}{"{}ftp.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.Port\ =\ 21;}
\DoxyCodeLine{\ \ \ \ options.Username\ =\ \textcolor{stringliteral}{"{}user"{}};}
\DoxyCodeLine{\ \ \ \ options.Password\ =\ \textcolor{stringliteral}{"{}password"{}};}
\DoxyCodeLine{\ \ \ \ options.Protocol\ =\ FileTransferProtocol.Ftp;}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Secure\ FTPS}}
\DoxyCodeLine{services.AddFtpFileTransfer(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.Host\ =\ \textcolor{stringliteral}{"{}ftp.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.Port\ =\ 21;}
\DoxyCodeLine{\ \ \ \ options.Username\ =\ \textcolor{stringliteral}{"{}user"{}};}
\DoxyCodeLine{\ \ \ \ options.Password\ =\ \textcolor{stringliteral}{"{}password"{}};}
\DoxyCodeLine{\ \ \ \ options.Protocol\ =\ FileTransferProtocol.Ftps;}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ From\ configuration}}
\DoxyCodeLine{services.AddFtpFileTransfer(configuration.GetSection(\textcolor{stringliteral}{"{}Ftp"{}}));}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md71}{}\doxysubsubsection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md71}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }FileService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ IFileTransferService\ \_ftp;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ FileService(IFileTransferService\ ftp)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_ftp\ =\ ftp;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ TransferFilesAsync()}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Upload\ single\ file}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_ftp.UploadOneAsync(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ localPath:\ \textcolor{stringliteral}{@"{}C:\(\backslash\)local\(\backslash\)file.txt"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ remotePath:\ \textcolor{stringliteral}{"{}/remote/file.txt"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ overwrite:\ \textcolor{keyword}{true});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Download\ single\ file}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_ftp.DownloadOneAsync(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ remotePath:\ \textcolor{stringliteral}{"{}/remote/file.txt"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ localPath:\ \textcolor{stringliteral}{@"{}C:\(\backslash\)local\(\backslash\)downloaded.txt"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Batch\ upload}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ uploads\ =\ \textcolor{keyword}{new}[]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{@"{}C:\(\backslash\)local\(\backslash\)file1.txt"{}},\ \textcolor{stringliteral}{"{}/remote/file1.txt"{}}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{@"{}C:\(\backslash\)local\(\backslash\)file2.txt"{}},\ \textcolor{stringliteral}{"{}/remote/file2.txt"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ successCount\ =\ await\ \_ftp.UploadBatchAsync(uploads);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Batch\ download}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ downloads\ =\ \textcolor{keyword}{new}[]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}/remote/file1.txt"{}},\ \textcolor{stringliteral}{@"{}C:\(\backslash\)local\(\backslash\)file1.txt"{}}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}/remote/file2.txt"{}},\ \textcolor{stringliteral}{@"{}C:\(\backslash\)local\(\backslash\)file2.txt"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ downloaded\ =\ await\ \_ftp.DownloadBatchAsync(downloads);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md73}{}\doxysubsection{\texorpdfstring{SFTP}{SFTP}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md73}
Secure file transfer over SSH (SFTP protocol).\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md74}{}\doxysubsubsection{\texorpdfstring{Registration}{Registration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md74}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Password\ authentication}}
\DoxyCodeLine{services.AddSftpFileTransfer(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.Host\ =\ \textcolor{stringliteral}{"{}sftp.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.Port\ =\ 22;}
\DoxyCodeLine{\ \ \ \ options.Username\ =\ \textcolor{stringliteral}{"{}user"{}};}
\DoxyCodeLine{\ \ \ \ options.Password\ =\ \textcolor{stringliteral}{"{}password"{}};}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Private\ key\ authentication}}
\DoxyCodeLine{services.AddSftpFileTransfer(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.Host\ =\ \textcolor{stringliteral}{"{}sftp.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.Port\ =\ 22;}
\DoxyCodeLine{\ \ \ \ options.Username\ =\ \textcolor{stringliteral}{"{}user"{}};}
\DoxyCodeLine{\ \ \ \ options.PrivateKeyPath\ =\ \textcolor{stringliteral}{@"{}C:\(\backslash\)keys\(\backslash\)id\_rsa"{}};}
\DoxyCodeLine{\ \ \ \ options.PrivateKeyPassphrase\ =\ \textcolor{stringliteral}{"{}passphrase"{}};\ \textcolor{comment}{//\ Optional}}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Private\ key\ from\ string}}
\DoxyCodeLine{services.AddSftpFileTransfer(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.Host\ =\ \textcolor{stringliteral}{"{}sftp.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.Username\ =\ \textcolor{stringliteral}{"{}user"{}};}
\DoxyCodeLine{\ \ \ \ options.PrivateKeyContent\ =\ \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/BEGIN\ RSA\ PRIVATE\ KEY-\/-\/-\/-\/-\/\(\backslash\)n..."{}};}
\DoxyCodeLine{\});}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md75}{}\doxysubsubsection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md75}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }SecureFileService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ IFileTransferService\ \_sftp;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ SecureFileService(IFileTransferService\ sftp)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_sftp\ =\ sftp;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ TransferAsync(CancellationToken\ ct)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Upload\ with\ cancellation\ support}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_sftp.UploadOneAsync(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{@"{}C:\(\backslash\)data\(\backslash\)report.pdf"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}/uploads/report.pdf"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ overwrite:\ \textcolor{keyword}{true},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ct);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Download}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_sftp.DownloadOneAsync(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}/downloads/data.csv"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{@"{}C:\(\backslash\)data\(\backslash\)data.csv"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ cancellationToken:\ ct);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md76}{}\doxysubsubsection{\texorpdfstring{Configuration Options}{Configuration Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md76}

\begin{DoxyTable}{4}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Option  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Default  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Host}  &string  &-\/  &Server hostname  \\
{\ttfamily Port}  &int  &21/\+22  &Server port  \\
{\ttfamily Username}  &string  &-\/  &Login username  \\
{\ttfamily Password}  &string?  &null  &Password (if using password auth)  \\
{\ttfamily Private\+Key\+Path}  &string?  &null  &Path to private key file  \\
{\ttfamily Private\+Key\+Content}  &string?  &null  &Private key as string  \\
{\ttfamily Private\+Key\+Passphrase}  &string?  &null  &Private key passphrase  \\
{\ttfamily Protocol}  &File\+Transfer\+Protocol  &Ftp  &Ftp, Ftps, or Sftp  \\
{\ttfamily Connection\+Timeout}  &Time\+Span  &30s  &Connection timeout  \\
{\ttfamily Operation\+Timeout}  &Time\+Span  &5min  &Operation timeout  \\
{\ttfamily Buffer\+Size}  &int  &32KB  &Transfer buffer size  \\
{\ttfamily Auto\+Create\+Directory}  &bool  &true  &Auto-\/create remote directories  \\
\end{DoxyTable}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md78}{}\doxysection{\texorpdfstring{Mailing Services}{Mailing Services}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md78}
SMTP email sending service with TLS/\+\+SSL, OAuth2, and attachment support.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md79}{}\doxysubsection{\texorpdfstring{Registration}{Registration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md79}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Generic\ SMTP}}
\DoxyCodeLine{services.AddSmtpMailing(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.Host\ =\ \textcolor{stringliteral}{"{}smtp.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.Port\ =\ 587;}
\DoxyCodeLine{\ \ \ \ options.SecurityMode\ =\ SmtpSecurityMode.StartTls;}
\DoxyCodeLine{\ \ \ \ options.Username\ =\ \textcolor{stringliteral}{"{}user@example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.Password\ =\ \textcolor{stringliteral}{"{}password"{}};}
\DoxyCodeLine{\ \ \ \ options.DefaultFrom\ =\ \textcolor{keyword}{new}\ EmailAddress(\textcolor{stringliteral}{"{}noreply@example.com"{}},\ \textcolor{stringliteral}{"{}My\ App"{}});}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Gmail\ shortcut}}
\DoxyCodeLine{services.AddGmailMailing(}
\DoxyCodeLine{\ \ \ \ email:\ \textcolor{stringliteral}{"{}myapp@gmail.com"{}},}
\DoxyCodeLine{\ \ \ \ appPassword:\ \textcolor{stringliteral}{"{}xxxx-\/xxxx-\/xxxx-\/xxxx"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Outlook/Office\ 365\ shortcut}}
\DoxyCodeLine{services.AddOutlookMailing(}
\DoxyCodeLine{\ \ \ \ email:\ \textcolor{stringliteral}{"{}myapp@outlook.com"{}},}
\DoxyCodeLine{\ \ \ \ password:\ \textcolor{stringliteral}{"{}password"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Anonymous\ relay\ (internal\ servers)}}
\DoxyCodeLine{services.AddSmtpMailing(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.Host\ =\ \textcolor{stringliteral}{"{}mail.internal.local"{}};}
\DoxyCodeLine{\ \ \ \ options.Port\ =\ 25;}
\DoxyCodeLine{\ \ \ \ options.SecurityMode\ =\ SmtpSecurityMode.None;}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ From\ configuration}}
\DoxyCodeLine{services.AddSmtpMailing(configuration.GetSection(\textcolor{stringliteral}{"{}Mailing"{}}));}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md80}{}\doxysubsection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md80}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }NotificationService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ IMailingService\ \_mailing;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ NotificationService(IMailingService\ mailing)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_mailing\ =\ mailing;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ SendWelcomeEmailAsync(\textcolor{keywordtype}{string}\ userEmail,\ \textcolor{keywordtype}{string}\ userName)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ message\ =\ \textcolor{keyword}{new}\ EmailMessage}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ From\ =\ \textcolor{keyword}{new}\ EmailAddress(\textcolor{stringliteral}{"{}noreply@example.com"{}},\ \textcolor{stringliteral}{"{}My\ Application"{}}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Subject\ =\ \textcolor{stringliteral}{"{}Welcome\ to\ Our\ Service!"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Body\ =\ \$\textcolor{stringliteral}{"{}<h1>Welcome,\ \{userName\}!</h1><p>Thank\ you\ for\ joining\ us.</p>"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ IsBodyHtml\ =\ \textcolor{keyword}{true},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ To\ =\ \{\ \textcolor{keyword}{new}\ EmailAddress(userEmail,\ userName)\ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_mailing.SendMailAsync(message);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ SendReportAsync(\textcolor{keywordtype}{string}[]\ recipients,\ \textcolor{keywordtype}{byte}[]\ pdfReport)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ message\ =\ \textcolor{keyword}{new}\ EmailMessage}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ From\ =\ \textcolor{keyword}{new}\ EmailAddress(\textcolor{stringliteral}{"{}reports@example.com"{}},\ \textcolor{stringliteral}{"{}Report\ System"{}}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Subject\ =\ \textcolor{stringliteral}{"{}Monthly\ Report"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Body\ =\ \textcolor{stringliteral}{"{}Please\ find\ the\ monthly\ report\ attached."{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ IsBodyHtml\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Attachments\ =}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EmailAttachment.FromBytes(pdfReport,\ \textcolor{stringliteral}{"{}report.pdf"{}},\ \textcolor{stringliteral}{"{}application/pdf"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Multiple\ recipients}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ recipient\ \textcolor{keywordflow}{in}\ recipients)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ message.To.Add(recipient);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_mailing.SendMailAsync(message);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ SendBccEmailAsync(\textcolor{keywordtype}{string}[]\ bccRecipients)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Email\ with\ BCC\ only\ (no\ visible\ recipients)}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ message\ =\ \textcolor{keyword}{new}\ EmailMessage}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ From\ =\ \textcolor{keyword}{new}\ EmailAddress(\textcolor{stringliteral}{"{}newsletter@example.com"{}}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Subject\ =\ \textcolor{stringliteral}{"{}Newsletter"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Body\ =\ \textcolor{stringliteral}{"{}<h1>Monthly\ Newsletter</h1>"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ IsBodyHtml\ =\ \textcolor{keyword}{true}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ bcc\ \textcolor{keywordflow}{in}\ bccRecipients)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ message.Bcc.Add(bcc);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_mailing.SendMailAsync(message);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md81}{}\doxysubsection{\texorpdfstring{Email with Inline Images}{Email with Inline Images}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md81}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ logoBytes\ =\ File.ReadAllBytes(\textcolor{stringliteral}{"{}logo.png"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{var\ message\ =\ \textcolor{keyword}{new}\ EmailMessage}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ From\ =\ \textcolor{keyword}{new}\ EmailAddress(\textcolor{stringliteral}{"{}noreply@example.com"{}}),}
\DoxyCodeLine{\ \ \ \ Subject\ =\ \textcolor{stringliteral}{"{}Email\ with\ Logo"{}},}
\DoxyCodeLine{\ \ \ \ Body\ =\ \textcolor{stringliteral}{@"{}}}
\DoxyCodeLine{\textcolor{stringliteral}{\ \ \ \ \ \ \ \ <html>}}
\DoxyCodeLine{\textcolor{stringliteral}{\ \ \ \ \ \ \ \ <body>}}
\DoxyCodeLine{\textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ <img\ src='cid:company-\/logo'\ alt='Logo'\ />}}
\DoxyCodeLine{\textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ <h1>Welcome!</h1>}}
\DoxyCodeLine{\textcolor{stringliteral}{\ \ \ \ \ \ \ \ </body>}}
\DoxyCodeLine{\textcolor{stringliteral}{\ \ \ \ \ \ \ \ </html>"{}},}
\DoxyCodeLine{\ \ \ \ IsBodyHtml\ =\ \textcolor{keyword}{true},}
\DoxyCodeLine{\ \ \ \ To\ =\ \{\ \textcolor{stringliteral}{"{}recipient@example.com"{}}\ \},}
\DoxyCodeLine{\ \ \ \ Attachments\ =}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ EmailAttachment.CreateInline(logoBytes,\ \textcolor{stringliteral}{"{}logo.png"{}},\ \textcolor{stringliteral}{"{}company-\/logo"{}})}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{await\ \_mailing.SendMailAsync(message);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md82}{}\doxysubsection{\texorpdfstring{Configuration Options}{Configuration Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md82}

\begin{DoxyTable}{4}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Option  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Default  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Host}  &string  &"{}localhost"{}  &SMTP server hostname  \\
{\ttfamily Port}  &int  &25  &SMTP port (25, 587, 465)  \\
{\ttfamily Security\+Mode}  &Smtp\+Security\+Mode  &Auto  &Security mode  \\
{\ttfamily Username}  &string?  &null  &SMTP username  \\
{\ttfamily Password}  &string?  &null  &SMTP password  \\
{\ttfamily OAuth2\+Access\+Token}  &string?  &null  &OAuth2 token (Gmail, O365)  \\
{\ttfamily Connection\+Timeout}  &Time\+Span  &30s  &Connection timeout  \\
{\ttfamily Operation\+Timeout}  &Time\+Span  &2min  &Send timeout  \\
{\ttfamily Validate\+Certificate}  &bool  &true  &Validate SSL certificate  \\
{\ttfamily Default\+From}  &Email\+Address?  &null  &Default sender address  \\
{\ttfamily Default\+Reply\+To}  &Email\+Address?  &null  &Default reply-\/to address  \\
\end{DoxyTable}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md83}{}\doxysubsection{\texorpdfstring{Security Modes}{Security Modes}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md83}

\begin{DoxyTable}{3}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Mode  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Port  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Auto}  &-\/  &Automatic detection  \\
{\ttfamily None}  &25  &No encryption (internal only)  \\
{\ttfamily Start\+Tls}  &587  &Upgrade to TLS (recommended)  \\
{\ttfamily Start\+Tls\+When\+Available}  &587  &TLS if available  \\
{\ttfamily Ssl\+On\+Connect}  &465  &Implicit SSL/\+\+TLS  \\
\end{DoxyTable}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md85}{}\doxysection{\texorpdfstring{API Services}{API Services}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md85}
HTTP API client service with multiple authentication modes and automatic retry.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md86}{}\doxysubsection{\texorpdfstring{Registration}{Registration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md86}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Anonymous\ API}}
\DoxyCodeLine{services.AddHttpApiAnonymous(\textcolor{stringliteral}{"{}https://api.example.com"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Bearer\ token\ authentication}}
\DoxyCodeLine{services.AddHttpApiWithBearerToken(}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}https://api.example.com"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}your-\/bearer-\/token"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Basic\ authentication}}
\DoxyCodeLine{services.AddHttpApiWithBasicAuth(}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}https://api.example.com"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}username"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}password"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ API\ key\ authentication\ (header)}}
\DoxyCodeLine{services.AddHttpApiWithApiKey(}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}https://api.example.com"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}your-\/api-\/key"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}X-\/API-\/Key"{}},}
\DoxyCodeLine{\ \ \ \ ApiKeyLocation.Header);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ API\ key\ authentication\ (query\ string)}}
\DoxyCodeLine{services.AddHttpApiWithApiKey(}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}https://api.example.com"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}your-\/api-\/key"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}api\_key"{}},}
\DoxyCodeLine{\ \ \ \ ApiKeyLocation.QueryString);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Client\ certificate\ authentication}}
\DoxyCodeLine{services.AddHttpApiWithCertificate(}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}https://api.example.com"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{new}\ X509Certificate2(\textcolor{stringliteral}{"{}client.pfx"{}},\ \textcolor{stringliteral}{"{}password"{}}));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ OAuth2\ client\ credentials}}
\DoxyCodeLine{services.AddHttpApiWithOAuth2(}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}https://api.example.com"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}https://auth.example.com/oauth/token"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}client-\/id"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}client-\/secret"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}read\ write"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Full\ configuration}}
\DoxyCodeLine{services.AddHttpApi(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.BaseUrl\ =\ \textcolor{stringliteral}{"{}https://api.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.AuthenticationMode\ =\ ApiAuthenticationMode.BearerToken;}
\DoxyCodeLine{\ \ \ \ options.BearerToken\ =\ \textcolor{stringliteral}{"{}your-\/token"{}};}
\DoxyCodeLine{\ \ \ \ options.Timeout\ =\ TimeSpan.FromSeconds(30);}
\DoxyCodeLine{\ \ \ \ options.MaxRetries\ =\ 3;}
\DoxyCodeLine{\ \ \ \ options.UseExponentialBackoff\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ From\ configuration}}
\DoxyCodeLine{services.AddHttpApi(configuration.GetSection(\textcolor{stringliteral}{"{}Api"{}}));}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md87}{}\doxysubsection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md87}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }DataService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ IApiService\ \_api;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ DataService(IApiService\ api)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_api\ =\ api;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<User?>\ GetUserAsync(\textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id})}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Simple\ GET\ request}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ request\ =\ ApiRequest.Get(\$\textcolor{stringliteral}{"{}/users/\{id\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ response\ =\ await\ \_api.SendAsync(request);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ response.EnsureSuccess();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ response.Deserialize<User>();}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<User?>\ CreateUserAsync(User\ user)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ POST\ with\ JSON\ body}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ request\ =\ ApiRequest.Post(\textcolor{stringliteral}{"{}/users"{}},\ user);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_api.SendAsync<User>(request);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ UpdateUserAsync(\textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id},\ User\ user)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ PUT\ with\ JSON\ body}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ request\ =\ ApiRequest.Put(\$\textcolor{stringliteral}{"{}/users/\{id\}"{}},\ user);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_api.SendAsync(request);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ PatchUserAsync(\textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id},\ \textcolor{keywordtype}{object}\ partialData)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ PATCH\ with\ JSON\ body}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ request\ =\ ApiRequest.Patch(\$\textcolor{stringliteral}{"{}/users/\{id\}"{}},\ partialData);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_api.SendAsync(request);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ DeleteUserAsync(\textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id})}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ DELETE\ request}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ request\ =\ ApiRequest.Delete(\$\textcolor{stringliteral}{"{}/users/\{id\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_api.SendAsync(request);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md88}{}\doxysubsection{\texorpdfstring{Advanced Usage}{Advanced Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md88}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }AdvancedApiService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ IApiService\ \_api;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ AdvancedApiService(IApiService\ api)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_api\ =\ api;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<SearchResult>\ SearchAsync(\textcolor{keywordtype}{string}\ query,\ \textcolor{keywordtype}{int}\ page)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Request\ with\ query\ parameters\ and\ headers}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ request\ =\ ApiRequest.Get(\textcolor{stringliteral}{"{}/search"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ .WithQuery(\textcolor{stringliteral}{"{}q"{}},\ query)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ .WithQuery(\textcolor{stringliteral}{"{}page"{}},\ page.ToString())}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ .WithHeader(\textcolor{stringliteral}{"{}X-\/Request-\/ID"{}},\ Guid.NewGuid().ToString())}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ .WithTimeout(TimeSpan.FromSeconds(60));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ response\ =\ await\ \_api.SendAsync(request);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (response.IsSuccess)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ response.Deserialize<SearchResult>()!;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (response.IsClientError)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ InvalidOperationException(\$\textcolor{stringliteral}{"{}Client\ error:\ \{response.ReasonPhrase\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ HttpRequestException(\$\textcolor{stringliteral}{"{}Server\ error:\ \{response.StatusCode\}"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ UploadFileAsync(\textcolor{keywordtype}{byte}[]\ fileData,\ \textcolor{keywordtype}{string}\ fileName)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Binary\ content}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ request\ =\ ApiRequest.Post(\textcolor{stringliteral}{"{}/upload"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ .SetBinaryContent(fileData,\ \textcolor{stringliteral}{"{}application/octet-\/stream"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ .WithHeader(\textcolor{stringliteral}{"{}X-\/File-\/Name"{}},\ fileName);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_api.SendAsync(request);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ SubmitFormAsync(Dictionary<string,\ string>\ formData)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Form\ URL-\/encoded\ content}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ request\ =\ ApiRequest.Post(\textcolor{stringliteral}{"{}/form"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ .SetFormContent(formData);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_api.SendAsync(request);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md89}{}\doxysubsection{\texorpdfstring{Configuration Options}{Configuration Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md89}

\begin{DoxyTable}{4}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Option  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Default  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Base\+Url}  &string?  &null  &Base URL for all requests  \\
{\ttfamily Authentication\+Mode}  &Api\+Authentication\+Mode  &Anonymous  &Authentication method  \\
{\ttfamily Timeout}  &Time\+Span  &30s  &Request timeout  \\
{\ttfamily Max\+Retries}  &int  &3  &Maximum retry attempts  \\
{\ttfamily Retry\+Delay}  &Time\+Span  &1s  &Delay between retries  \\
{\ttfamily Use\+Exponential\+Backoff}  &bool  &true  &Use exponential backoff  \\
{\ttfamily Validate\+Certificate}  &bool  &true  &Validate SSL certificates  \\
{\ttfamily Follow\+Redirects}  &bool  &true  &Follow HTTP redirects  \\
{\ttfamily Max\+Redirects}  &int  &10  &Maximum redirects to follow  \\
{\ttfamily User\+Agent}  &string  &"{}\+Toolbox..."{}  &Default User-\/\+Agent header  \\
\end{DoxyTable}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md90}{}\doxysubsection{\texorpdfstring{Authentication Modes}{Authentication Modes}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md90}

\begin{DoxyTable}{2}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Mode  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Anonymous}  &No authentication  \\
{\ttfamily Bearer\+Token}  &Bearer token in Authorization header  \\
{\ttfamily Basic}  &Basic authentication (username:\+password)  \\
{\ttfamily Api\+Key}  &API key in header or query string  \\
{\ttfamily Certificate}  &Client certificate authentication  \\
{\ttfamily OAuth2\+Client\+Credentials}  &OAuth2 client credentials flow  \\
\end{DoxyTable}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md92}{}\doxysection{\texorpdfstring{LDAP Services}{LDAP Services}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md92}
Directory services for querying users, groups, and computers from various LDAP providers.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md93}{}\doxysubsection{\texorpdfstring{Active Directory}{Active Directory}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md93}
Windows Active Directory service using LDAP protocol.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md94}{}\doxysubsubsection{\texorpdfstring{Registration}{Registration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md94}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Using\ current\ Windows\ credentials}}
\DoxyCodeLine{services.AddActiveDirectory(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.Domain\ =\ \textcolor{stringliteral}{"{}corp.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.UseCurrentCredentials\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\ \ \ \ options.UseSsl\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Using\ explicit\ credentials}}
\DoxyCodeLine{services.AddActiveDirectory(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.Domain\ =\ \textcolor{stringliteral}{"{}corp.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.Server\ =\ \textcolor{stringliteral}{"{}dc01.corp.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.Port\ =\ 636;}
\DoxyCodeLine{\ \ \ \ options.UseSsl\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\ \ \ \ options.Username\ =\ \textcolor{stringliteral}{"{}CORP\(\backslash\)\(\backslash\)serviceaccount"{}};}
\DoxyCodeLine{\ \ \ \ options.Password\ =\ \textcolor{stringliteral}{"{}password"{}};}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ From\ configuration}}
\DoxyCodeLine{services.AddActiveDirectory(configuration.GetSection(\textcolor{stringliteral}{"{}Toolbox:Ldap:ActiveDirectory"{}}));}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md95}{}\doxysubsubsection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md95}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }UserService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ILdapService\ \_ldap;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ UserService(ILdapService\ ldap)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_ldap\ =\ ldap;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<LdapUser?>\ FindUserAsync(\textcolor{keywordtype}{string}\ username)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ user\ =\ await\ \_ldap.GetUserByUsernameAsync(username);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (user\ !=\ \textcolor{keyword}{null})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Found:\ \{user.DisplayName\}\ (\{user.Email\})"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Department:\ \{user.Department\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ user;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<bool>\ ValidateUserAsync(\textcolor{keywordtype}{string}\ username,\ \textcolor{keywordtype}{string}\ password)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_ldap.ValidateCredentialsAsync(username,\ password);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<PagedResult<LdapUser>>\ SearchUsersAsync(\textcolor{keywordtype}{string}\ department)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ criteria\ =\ LdapSearchCriteria.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ .WithDepartment(department)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ .EnabledOnly();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_ldap.SearchUsersAsync(criteria,\ page:\ 1,\ pageSize:\ 25);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md96}{}\doxysubsubsection{\texorpdfstring{Group and Computer Operations}{Group and Computer Operations}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md96}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Get\ group\ by\ name}}
\DoxyCodeLine{var\ group\ =\ await\ \_ldap.GetGroupByNameAsync(\textcolor{stringliteral}{"{}Developers"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Get\ group\ members\ with\ pagination}}
\DoxyCodeLine{var\ members\ =\ await\ \_ldap.GetGroupMembersAsync(\textcolor{stringliteral}{"{}CN=Developers,OU=Groups,DC=example,DC=com"{}},\ page:\ 1,\ pageSize:\ 50);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Get\ computer\ by\ name}}
\DoxyCodeLine{var\ computer\ =\ await\ \_ldap.GetComputerByNameAsync(\textcolor{stringliteral}{"{}SERVER01"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Search\ servers}}
\DoxyCodeLine{var\ criteria\ =\ LdapComputerSearchCriteria.Create()}
\DoxyCodeLine{\ \ \ \ .WithOperatingSystem(\textcolor{stringliteral}{"{}Windows\ Server*"{}})}
\DoxyCodeLine{\ \ \ \ .EnabledOnly();}
\DoxyCodeLine{var\ servers\ =\ await\ \_ldap.SearchComputersAsync(criteria,\ page:\ 1,\ pageSize:\ 25);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md97}{}\doxysubsubsection{\texorpdfstring{Configuration Options}{Configuration Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md97}

\begin{DoxyTable}{4}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Option  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Default  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Domain}  &string  &-\/  &Fully qualified domain name  \\
{\ttfamily Server}  &string?  &null  &Domain controller (auto-\/discovers if null)  \\
{\ttfamily Port}  &int  &389  &LDAP port (636 for SSL)  \\
{\ttfamily Base\+Dn}  &string?  &null  &Base DN for searches  \\
{\ttfamily Username}  &string?  &null  &Bind username  \\
{\ttfamily Password}  &string?  &null  &Bind password  \\
{\ttfamily Use\+Ssl}  &bool  &false  &Use SSL/\+\+TLS (LDAPS)  \\
{\ttfamily Use\+Current\+Credentials}  &bool  &false  &Use Windows integrated auth  \\
{\ttfamily Validate\+Certificate}  &bool  &true  &Validate SSL certificate  \\
{\ttfamily Connection\+Timeout}  &Time\+Span  &30s  &Connection timeout  \\
{\ttfamily Operation\+Timeout}  &Time\+Span  &60s  &Operation timeout  \\
\end{DoxyTable}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md99}{}\doxysubsection{\texorpdfstring{Azure AD /\+ Entra ID}{Azure AD /\+ Entra ID}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md99}
Azure Active Directory service using Microsoft Graph API.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md100}{}\doxysubsubsection{\texorpdfstring{Registration}{Registration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md100}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Client\ secret\ authentication}}
\DoxyCodeLine{services.AddAzureAd(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.TenantId\ =\ \textcolor{stringliteral}{"{}your-\/tenant-\/id"{}};}
\DoxyCodeLine{\ \ \ \ options.ClientId\ =\ \textcolor{stringliteral}{"{}your-\/client-\/id"{}};}
\DoxyCodeLine{\ \ \ \ options.ClientSecret\ =\ \textcolor{stringliteral}{"{}your-\/client-\/secret"{}};}
\DoxyCodeLine{\ \ \ \ options.AuthenticationMode\ =\ AzureAdAuthMode.ClientSecret;}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Managed\ identity\ (Azure-\/hosted\ apps)}}
\DoxyCodeLine{services.AddAzureAdWithManagedIdentity(}
\DoxyCodeLine{\ \ \ \ tenantId:\ \textcolor{stringliteral}{"{}your-\/tenant-\/id"{}},}
\DoxyCodeLine{\ \ \ \ clientId:\ \textcolor{stringliteral}{"{}your-\/client-\/id"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Certificate\ authentication}}
\DoxyCodeLine{services.AddAzureAd(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.TenantId\ =\ \textcolor{stringliteral}{"{}your-\/tenant-\/id"{}};}
\DoxyCodeLine{\ \ \ \ options.ClientId\ =\ \textcolor{stringliteral}{"{}your-\/client-\/id"{}};}
\DoxyCodeLine{\ \ \ \ options.CertificatePath\ =\ \textcolor{stringliteral}{"{}/path/to/cert.pfx"{}};}
\DoxyCodeLine{\ \ \ \ options.CertificatePassword\ =\ \textcolor{stringliteral}{"{}password"{}};}
\DoxyCodeLine{\ \ \ \ options.AuthenticationMode\ =\ AzureAdAuthMode.Certificate;}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ From\ configuration}}
\DoxyCodeLine{services.AddAzureAd(configuration.GetSection(\textcolor{stringliteral}{"{}Toolbox:Ldap:AzureAd"{}}));}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md101}{}\doxysubsubsection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md101}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }AzureUserService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ILdapService\ \_azureAd;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ AzureUserService(ILdapService\ azureAd)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_azureAd\ =\ azureAd;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<LdapUser?>\ GetUserAsync(\textcolor{keywordtype}{string}\ email)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_azureAd.GetUserByEmailAsync(email);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<IEnumerable<LdapUser>>\ SearchByDepartmentAsync(\textcolor{keywordtype}{string}\ department)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Azure\ AD\ uses\ OData\ filter\ syntax}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_azureAd.SearchUsersAsync(\$\textcolor{stringliteral}{"{}department\ eq\ '\{department\}'"{}},\ maxResults:\ 50);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<IEnumerable<LdapGroup>>\ GetSecurityGroupsAsync()}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_azureAd.SearchGroupsAsync(\textcolor{stringliteral}{"{}securityEnabled\ eq\ true"{}},\ maxResults:\ 100);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md102}{}\doxysubsubsection{\texorpdfstring{Important Notes}{Important Notes}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md102}

\begin{DoxyItemize}
\item Azure AD does not support {\ttfamily Validate\+Credentials()} -\/ use Azure AD authentication flows instead
\item Search filters use OData syntax, not LDAP filter syntax
\item Computer queries return Azure AD joined devices
\end{DoxyItemize}\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md103}{}\doxysubsubsection{\texorpdfstring{Configuration Options}{Configuration Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md103}

\begin{DoxyTable}{4}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Option  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Default  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Tenant\+Id}  &string  &-\/  &Azure AD tenant ID or domain  \\
{\ttfamily Client\+Id}  &string  &-\/  &Application (client) ID  \\
{\ttfamily Client\+Secret}  &string?  &null  &Client secret  \\
{\ttfamily Authentication\+Mode}  &Azure\+Ad\+Auth\+Mode  &Client\+Secret  &Authentication method  \\
{\ttfamily Use\+Managed\+Identity}  &bool  &false  &Use Azure Managed Identity  \\
{\ttfamily Certificate\+Path}  &string?  &null  &Path to certificate file  \\
{\ttfamily Certificate\+Thumbprint}  &string?  &null  &Certificate thumbprint  \\
{\ttfamily Graph\+Api\+Base\+Url}  &string  &v1.\+0 endpoint  &Microsoft Graph API URL  \\
\end{DoxyTable}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md105}{}\doxysubsection{\texorpdfstring{Open\+LDAP}{Open\+LDAP}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md105}
Open\+LDAP or compatible Linux directory service.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md106}{}\doxysubsubsection{\texorpdfstring{Registration}{Registration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md106}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Basic\ configuration}}
\DoxyCodeLine{services.AddOpenLdap(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.Host\ =\ \textcolor{stringliteral}{"{}ldap.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.Port\ =\ 389;}
\DoxyCodeLine{\ \ \ \ options.BaseDn\ =\ \textcolor{stringliteral}{"{}dc=example,dc=com"{}};}
\DoxyCodeLine{\ \ \ \ options.BindDn\ =\ \textcolor{stringliteral}{"{}cn=admin,dc=example,dc=com"{}};}
\DoxyCodeLine{\ \ \ \ options.BindPassword\ =\ \textcolor{stringliteral}{"{}secret"{}};}
\DoxyCodeLine{\ \ \ \ options.SecurityMode\ =\ LdapSecurityMode.StartTls;}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ FreeIPA\ configuration}}
\DoxyCodeLine{services.AddOpenLdap(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.Host\ =\ \textcolor{stringliteral}{"{}ipa.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.Port\ =\ 636;}
\DoxyCodeLine{\ \ \ \ options.BaseDn\ =\ \textcolor{stringliteral}{"{}dc=example,dc=com"{}};}
\DoxyCodeLine{\ \ \ \ options.BindDn\ =\ \textcolor{stringliteral}{"{}uid=admin,cn=users,cn=accounts,dc=example,dc=com"{}};}
\DoxyCodeLine{\ \ \ \ options.BindPassword\ =\ \textcolor{stringliteral}{"{}secret"{}};}
\DoxyCodeLine{\ \ \ \ options.SecurityMode\ =\ LdapSecurityMode.Ssl;}
\DoxyCodeLine{\ \ \ \ options.UserObjectClass\ =\ \textcolor{stringliteral}{"{}inetOrgPerson"{}};}
\DoxyCodeLine{\ \ \ \ options.GroupObjectClass\ =\ \textcolor{stringliteral}{"{}groupOfNames"{}};}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ From\ configuration}}
\DoxyCodeLine{services.AddOpenLdap(configuration.GetSection(\textcolor{stringliteral}{"{}Toolbox:Ldap:OpenLdap"{}}));}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md107}{}\doxysubsubsection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md107}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }LinuxUserService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ILdapService\ \_ldap;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ LinuxUserService(ILdapService\ ldap)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_ldap\ =\ ldap;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<LdapUser?>\ GetUserAsync(\textcolor{keywordtype}{string}\ uid)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_ldap.GetUserByUsernameAsync(uid);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<bool>\ AuthenticateAsync(\textcolor{keywordtype}{string}\ uid,\ \textcolor{keywordtype}{string}\ password)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_ldap.ValidateCredentialsAsync(uid,\ password);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md108}{}\doxysubsubsection{\texorpdfstring{Configuration Options}{Configuration Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md108}

\begin{DoxyTable}{4}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Option  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Default  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Host}  &string  &-\/  &LDAP server hostname  \\
{\ttfamily Port}  &int  &389  &LDAP port  \\
{\ttfamily Base\+Dn}  &string  &-\/  &Base DN for searches  \\
{\ttfamily Bind\+Dn}  &string?  &null  &Bind DN for authentication  \\
{\ttfamily Bind\+Password}  &string?  &null  &Bind password  \\
{\ttfamily Security\+Mode}  &Ldap\+Security\+Mode  &None  &Security mode (None, Ssl, Start\+Tls)  \\
{\ttfamily User\+Object\+Class}  &string  &inet\+Org\+Person  &User object class  \\
{\ttfamily Group\+Object\+Class}  &string  &group\+Of\+Names  &Group object class  \\
{\ttfamily Username\+Attribute}  &string  &uid  &Username attribute  \\
\end{DoxyTable}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md110}{}\doxysubsection{\texorpdfstring{Apple Directory}{Apple Directory}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md110}
Apple Open Directory service for mac\+OS environments.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md111}{}\doxysubsubsection{\texorpdfstring{Registration}{Registration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md111}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{services.AddAppleDirectory(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.Host\ =\ \textcolor{stringliteral}{"{}od.example.com"{}};}
\DoxyCodeLine{\ \ \ \ options.Port\ =\ 389;}
\DoxyCodeLine{\ \ \ \ options.BaseDn\ =\ \textcolor{stringliteral}{"{}dc=example,dc=com"{}};}
\DoxyCodeLine{\ \ \ \ options.BindDn\ =\ \textcolor{stringliteral}{"{}uid=admin,cn=users,dc=example,dc=com"{}};}
\DoxyCodeLine{\ \ \ \ options.BindPassword\ =\ \textcolor{stringliteral}{"{}secret"{}};}
\DoxyCodeLine{\ \ \ \ options.UseSsl\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ From\ configuration}}
\DoxyCodeLine{services.AddAppleDirectory(configuration.GetSection(\textcolor{stringliteral}{"{}Toolbox:Ldap:AppleDirectory"{}}));}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md112}{}\doxysubsubsection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md112}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }MacUserService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ILdapService\ \_ldap;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ MacUserService(ILdapService\ ldap)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_ldap\ =\ ldap;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<LdapUser?>\ GetMacUserAsync(\textcolor{keywordtype}{string}\ uid)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_ldap.GetUserByUsernameAsync(uid);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<IEnumerable<string>>\ GetUserGroupsAsync(\textcolor{keywordtype}{string}\ uid)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_ldap.GetUserGroupsAsync(uid);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md113}{}\doxysubsubsection{\texorpdfstring{Configuration Options}{Configuration Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md113}

\begin{DoxyTable}{4}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Option  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Default  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Host}  &string  &-\/  &Directory server hostname  \\
{\ttfamily Port}  &int  &389  &LDAP port  \\
{\ttfamily Base\+Dn}  &string  &-\/  &Base DN  \\
{\ttfamily Bind\+Dn}  &string?  &null  &Bind DN  \\
{\ttfamily Bind\+Password}  &string?  &null  &Bind password  \\
{\ttfamily Use\+Ssl}  &bool  &false  &Use SSL  \\
{\ttfamily User\+Object\+Class}  &string  &apple-\/user  &Apple user object class  \\
{\ttfamily Group\+Object\+Class}  &string  &apple-\/group  &Apple group object class  \\
{\ttfamily Unique\+Id\+Attribute}  &string  &apple-\/generateduid  &Unique ID attribute  \\
\end{DoxyTable}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md115}{}\doxysubsection{\texorpdfstring{Advanced Authentication}{Advanced Authentication}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md115}
All LDAP services support advanced authentication methods beyond simple username/\+password authentication.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md116}{}\doxysubsubsection{\texorpdfstring{Authentication Modes}{Authentication Modes}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md116}

\begin{DoxyTable}{6}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Mode  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}AD  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Azure AD  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Open\+LDAP  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Apple  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Simple}  &\SetCell{c}  &\SetCell{c}\texorpdfstring{$\ast$}{*}  &\SetCell{c}  &\SetCell{c}  &DN + Password  \\
{\ttfamily Anonymous}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}  &No credentials  \\
{\ttfamily Kerberos}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}  &\SetCell{c}  &GSSAPI/\+\+SPNEGO  \\
{\ttfamily Ntlm}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}  &NTLM legacy  \\
{\ttfamily Negotiate}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}  &Auto Kerberos/\+\+NTLM  \\
{\ttfamily Integrated\+Windows}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}  &Current Windows context  \\
{\ttfamily Certificate}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}  &\SetCell{c}\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}  &X.\+509 client certificate  \\
{\ttfamily Sasl\+Plain}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}  &SASL PLAIN  \\
{\ttfamily Sasl\+External}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}  &\SetCell{c}\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}  &SASL EXTERNAL (certificate)  \\
{\ttfamily Sasl\+Gssapi}  &\SetCell{c}  &\SetCell{c}  &\SetCell{c}\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}  &\SetCell{c}  &SASL GSSAPI (Kerberos)  \\
\end{DoxyTable}



\begin{DoxyItemize}
\item Azure AD Simple maps to ROPC (Resource Owner Password Credentials) OAuth2 flow \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} Limited support -\/ may return failure with guidance
\end{DoxyItemize}\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md117}{}\doxysubsubsection{\texorpdfstring{Usage with Options}{Usage with Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md117}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Authenticate\ with\ options}}
\DoxyCodeLine{var\ authOptions\ =\ \textcolor{keyword}{new}\ LdapAuthenticationOptions}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ Mode\ =\ LdapAuthenticationMode.Simple,}
\DoxyCodeLine{\ \ \ \ Username\ =\ \textcolor{stringliteral}{"{}john.doe"{}},}
\DoxyCodeLine{\ \ \ \ Password\ =\ \textcolor{stringliteral}{"{}password"{}},}
\DoxyCodeLine{\ \ \ \ IncludeGroups\ =\ \textcolor{keyword}{true},}
\DoxyCodeLine{\ \ \ \ IncludeClaims\ =\ \textcolor{keyword}{true},}
\DoxyCodeLine{\ \ \ \ Timeout\ =\ TimeSpan.FromSeconds(30)}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{var\ result\ =\ await\ ldapService.AuthenticateAsync(authOptions);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordflow}{if}\ (result.IsAuthenticated)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Authenticated:\ \{result.Username\}"{}});}
\DoxyCodeLine{\ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}DN:\ \{result.UserDistinguishedName\}"{}});}
\DoxyCodeLine{\ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Groups:\ \{string.Join("{}},\ \textcolor{stringliteral}{"{},\ result.Groups\ ??\ [])\}"{}});}
\DoxyCodeLine{\}}
\DoxyCodeLine{\textcolor{keywordflow}{else}}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Failed:\ \{result.ErrorMessage\}\ (\{result.ErrorCode\})"{}});}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md118}{}\doxysubsubsection{\texorpdfstring{Kerberos Authentication (Active Directory)}{Kerberos Authentication (Active Directory)}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md118}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Using\ current\ Windows\ ticket\ (SSO)}}
\DoxyCodeLine{var\ result\ =\ await\ adService.AuthenticateWithKerberosAsync();}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Using\ explicit\ credentials}}
\DoxyCodeLine{var\ authOptions\ =\ \textcolor{keyword}{new}\ LdapAuthenticationOptions}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ Mode\ =\ LdapAuthenticationMode.Kerberos,}
\DoxyCodeLine{\ \ \ \ Username\ =\ \textcolor{stringliteral}{"{}john.doe@CORP.EXAMPLE.COM"{}},}
\DoxyCodeLine{\ \ \ \ Password\ =\ \textcolor{stringliteral}{"{}password"{}},}
\DoxyCodeLine{\ \ \ \ Domain\ =\ \textcolor{stringliteral}{"{}CORP"{}}}
\DoxyCodeLine{\};}
\DoxyCodeLine{var\ result\ =\ await\ adService.AuthenticateAsync(authOptions);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md119}{}\doxysubsubsection{\texorpdfstring{Integrated Windows Authentication}{Integrated Windows Authentication}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md119}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Uses\ the\ Windows\ identity\ of\ the\ current\ process}}
\DoxyCodeLine{var\ authOptions\ =\ \textcolor{keyword}{new}\ LdapAuthenticationOptions}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ Mode\ =\ LdapAuthenticationMode.IntegratedWindows}
\DoxyCodeLine{\};}
\DoxyCodeLine{var\ result\ =\ await\ adService.AuthenticateAsync(authOptions);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md120}{}\doxysubsubsection{\texorpdfstring{Certificate Authentication}{Certificate Authentication}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md120}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }System.Security.Cryptography.X509Certificates;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Using\ certificate\ object}}
\DoxyCodeLine{var\ cert\ =\ \textcolor{keyword}{new}\ X509Certificate2(\textcolor{stringliteral}{"{}client.pfx"{}},\ \textcolor{stringliteral}{"{}password"{}});}
\DoxyCodeLine{var\ result\ =\ await\ ldapService.AuthenticateWithCertificateAsync(cert);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Using\ options\ with\ certificate\ path}}
\DoxyCodeLine{var\ authOptions\ =\ \textcolor{keyword}{new}\ LdapAuthenticationOptions}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ Mode\ =\ LdapAuthenticationMode.Certificate,}
\DoxyCodeLine{\ \ \ \ CertificatePath\ =\ \textcolor{stringliteral}{"{}/path/to/client.pfx"{}},}
\DoxyCodeLine{\ \ \ \ CertificatePassword\ =\ \textcolor{stringliteral}{"{}password"{}}}
\DoxyCodeLine{\};}
\DoxyCodeLine{var\ result\ =\ await\ ldapService.AuthenticateAsync(authOptions);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md121}{}\doxysubsubsection{\texorpdfstring{Azure AD Interactive Authentication}{Azure AD Interactive Authentication}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md121}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Device\ code\ flow\ (for\ CLI\ apps)}}
\DoxyCodeLine{var\ result\ =\ await\ azureAdService.AuthenticateWithDeviceCodeAsync(async\ deviceCode\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Go\ to\ \{deviceCode.VerificationUri\}"{}});}
\DoxyCodeLine{\ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Enter\ code:\ \{deviceCode.UserCode\}"{}});}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordflow}{if}\ (result.IsAuthenticated)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Token:\ \{result.Token\}"{}});}
\DoxyCodeLine{\ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Expires:\ \{result.ExpiresAt\}"{}});}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Interactive\ browser\ flow\ (for\ desktop\ apps)}}
\DoxyCodeLine{var\ result\ =\ await\ azureAdService.AuthenticateWithInteractiveBrowserAsync();}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Username/Password\ (ROPC\ -\/\ not\ recommended)}}
\DoxyCodeLine{var\ result\ =\ await\ azureAdService.AuthenticateWithUsernamePasswordAsync(}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}user@domain.com"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}password"{}});}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md122}{}\doxysubsubsection{\texorpdfstring{Querying Supported Modes}{Querying Supported Modes}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md122}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Get\ supported\ authentication\ modes\ for\ the\ service}}
\DoxyCodeLine{var\ supportedModes\ =\ ldapService.GetSupportedAuthenticationModes();}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordflow}{foreach}\ (var\ mode\ \textcolor{keywordflow}{in}\ supportedModes)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Supported:\ \{mode\}"{}});}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md123}{}\doxysubsubsection{\texorpdfstring{Authentication Result}{Authentication Result}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md123}
The {\ttfamily Ldap\+Authentication\+Result} contains:\+


\begin{DoxyTable}{3}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Property  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Is\+Authenticated}  &bool  &Whether authentication succeeded  \\
{\ttfamily Username}  &string?  &Authenticated username  \\
{\ttfamily User\+Distinguished\+Name}  &string?  &User\textquotesingle{}s DN  \\
{\ttfamily Authentication\+Mode}  &Ldap\+Authentication\+Mode  &Mode used  \\
{\ttfamily Directory\+Type}  &Ldap\+Directory\+Type  &Directory type  \\
{\ttfamily Error\+Message}  &string?  &Error description (if failed)  \\
{\ttfamily Error\+Code}  &string?  &LDAP error code  \\
{\ttfamily Groups}  &IRead\+Only\+List$<$string$>$?  &User\textquotesingle{}s groups (if requested)  \\
{\ttfamily Claims}  &IDictionary$<$string, object$>$?  &Additional claims  \\
{\ttfamily Authenticated\+At}  &Date\+Time\+Offset?  &Authentication timestamp  \\
{\ttfamily Token}  &string?  &OAuth token (Azure AD)  \\
{\ttfamily Expires\+At}  &Date\+Time\+Offset?  &Token expiration  \\
\end{DoxyTable}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md124}{}\doxysubsection{\texorpdfstring{LDAP Management Operations}{LDAP Management Operations}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md124}
All LDAP services (Active Directory, Open\+LDAP, Apple Directory) support account management operations. Azure AD is read-\/only through Graph API.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md125}{}\doxysubsubsection{\texorpdfstring{Account Management}{Account Management}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md125}
Enable, disable, and unlock user or computer accounts.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Enable\ an\ account}}
\DoxyCodeLine{var\ enableResult\ =\ await\ \_ldap.EnableAccountAsync(}
\DoxyCodeLine{\ \ \ \ LdapAccountOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ForUser(\textcolor{stringliteral}{"{}jdoe"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .WithObjectType(LdapObjectType.User));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Disable\ an\ account}}
\DoxyCodeLine{var\ disableResult\ =\ await\ \_ldap.DisableAccountAsync(}
\DoxyCodeLine{\ \ \ \ LdapAccountOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ForUserDn(\textcolor{stringliteral}{"{}CN=John\ Doe,OU=Users,DC=contoso,DC=com"{}}));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Unlock\ a\ locked\ account}}
\DoxyCodeLine{var\ unlockResult\ =\ await\ \_ldap.UnlockAccountAsync(}
\DoxyCodeLine{\ \ \ \ LdapAccountOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ForUser(\textcolor{stringliteral}{"{}jdoe"{}}));}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md126}{}\doxysubsubsection{\texorpdfstring{Group Membership}{Group Membership}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md126}
Add or remove members from groups.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Add\ user\ to\ group}}
\DoxyCodeLine{var\ addResult\ =\ await\ \_ldap.AddToGroupAsync(}
\DoxyCodeLine{\ \ \ \ LdapGroupMembershipOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ForGroup(\textcolor{stringliteral}{"{}IT-\/Department"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .WithMemberUsername(\textcolor{stringliteral}{"{}jdoe"{}}));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Add\ multiple\ users\ to\ a\ group\ (batch)}}
\DoxyCodeLine{var\ batchAddResult\ =\ await\ \_ldap.AddToGroupBatchAsync(}
\DoxyCodeLine{\ \ \ \ LdapGroupMembershipOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ForGroup(\textcolor{stringliteral}{"{}Developers"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .WithMemberDns(\textcolor{keyword}{new}[]\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}CN=John\ Doe,OU=Users,DC=contoso,DC=com"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}CN=Jane\ Smith,OU=Users,DC=contoso,DC=com"{}}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ContinueOnErrors());\ \textcolor{comment}{//\ Continue\ even\ if\ one\ fails}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Remove\ user\ from\ group}}
\DoxyCodeLine{var\ removeResult\ =\ await\ \_ldap.RemoveFromGroupAsync(}
\DoxyCodeLine{\ \ \ \ LdapGroupMembershipOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ForGroupDn(\textcolor{stringliteral}{"{}CN=IT-\/Department,OU=Groups,DC=contoso,DC=com"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .WithMemberUsername(\textcolor{stringliteral}{"{}jdoe"{}}));}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md127}{}\doxysubsubsection{\texorpdfstring{Object Movement}{Object Movement}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md127}
Move objects between organizational units (OUs).


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Move\ user\ to\ another\ OU}}
\DoxyCodeLine{var\ moveResult\ =\ await\ \_ldap.MoveObjectAsync(}
\DoxyCodeLine{\ \ \ \ LdapMoveOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .FromDn(\textcolor{stringliteral}{"{}CN=John\ Doe,OU=Users,DC=contoso,DC=com"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ToContainer(\textcolor{stringliteral}{"{}OU=Contractors,DC=contoso,DC=com"{}}));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Rename\ an\ object}}
\DoxyCodeLine{var\ renameResult\ =\ await\ \_ldap.RenameObjectAsync(}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}CN=Old\ Name,OU=Users,DC=contoso,DC=com"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}New\ Name"{}});}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md128}{}\doxysubsubsection{\texorpdfstring{Password Management}{Password Management}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md128}
Change and reset user passwords.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ User-\/initiated\ password\ change\ (requires\ current\ password)}}
\DoxyCodeLine{var\ changeResult\ =\ await\ \_ldap.ChangePasswordAsync(}
\DoxyCodeLine{\ \ \ \ LdapPasswordOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ForUser(\textcolor{stringliteral}{"{}jdoe"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .WithCurrentPassword(\textcolor{stringliteral}{"{}OldP@ssw0rd"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .WithNewPassword(\textcolor{stringliteral}{"{}NewP@ssw0rd!"{}}));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Administrative\ password\ reset\ (no\ current\ password\ needed)}}
\DoxyCodeLine{var\ resetResult\ =\ await\ \_ldap.ResetPasswordAsync(}
\DoxyCodeLine{\ \ \ \ LdapPasswordOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ForUser(\textcolor{stringliteral}{"{}jdoe"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .WithNewPassword(\textcolor{stringliteral}{"{}Temp0rary!"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .MustChangeAtNextLogon()\ \ \ \ \textcolor{comment}{//\ Force\ password\ change}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .UnlockAccountOnReset());\ \ \ \textcolor{comment}{//\ Also\ unlock\ if\ locked}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Force\ password\ change\ at\ next\ logon}}
\DoxyCodeLine{var\ forceResult\ =\ await\ \_ldap.ForcePasswordChangeAtNextLogonAsync(}
\DoxyCodeLine{\ \ \ \ LdapAccountOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ForUser(\textcolor{stringliteral}{"{}jdoe"{}}));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Set\ password\ to\ never\ expire}}
\DoxyCodeLine{var\ neverExpireResult\ =\ await\ \_ldap.SetPasswordNeverExpiresAsync(}
\DoxyCodeLine{\ \ \ \ LdapAccountOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ForUser(\textcolor{stringliteral}{"{}serviceaccount"{}}),}
\DoxyCodeLine{\ \ \ \ neverExpires:\ \textcolor{keyword}{true});}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md129}{}\doxysubsubsection{\texorpdfstring{Azure AD Management via Microsoft Graph}{Azure AD Management via Microsoft Graph}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md129}
Azure AD management uses Microsoft Graph API instead of LDAP. The same {\ttfamily ILdap\+Service} interface works with Azure AD, but uses user IDs or UPNs instead of distinguished names.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Register\ Azure\ AD\ service}}
\DoxyCodeLine{services.AddAzureAd(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.TenantId\ =\ \textcolor{stringliteral}{"{}your-\/tenant-\/id"{}};}
\DoxyCodeLine{\ \ \ \ options.ClientId\ =\ \textcolor{stringliteral}{"{}your-\/client-\/id"{}};}
\DoxyCodeLine{\ \ \ \ options.ClientSecret\ =\ \textcolor{stringliteral}{"{}your-\/client-\/secret"{}};}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Use\ by\ user\ principal\ name\ (UPN)}}
\DoxyCodeLine{var\ result\ =\ await\ \_azureAd.EnableAccountAsync(}
\DoxyCodeLine{\ \ \ \ LdapAccountOptions.ForUser(\textcolor{stringliteral}{"{}john.doe@contoso.com"{}}));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Or\ by\ Azure\ AD\ object\ ID}}
\DoxyCodeLine{var\ result2\ =\ await\ \_azureAd.DisableAccountAsync(}
\DoxyCodeLine{\ \ \ \ LdapAccountOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .WithDn(\textcolor{stringliteral}{"{}12345678-\/1234-\/1234-\/1234-\/123456789012"{}}));\ \ \textcolor{comment}{//\ Object\ ID\ as\ "{}DN"{}}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Add\ user\ to\ Azure\ AD\ group}}
\DoxyCodeLine{var\ groupResult\ =\ await\ \_azureAd.AddToGroupAsync(}
\DoxyCodeLine{\ \ \ \ LdapGroupMembershipOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ForGroup(\textcolor{stringliteral}{"{}IT-\/Department"{}})\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Group\ display\ name}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .WithMemberUsername(\textcolor{stringliteral}{"{}john.doe@contoso.com"{}}));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Reset\ password\ with\ force\ change\ at\ next\ sign-\/in}}
\DoxyCodeLine{var\ passwordResult\ =\ await\ \_azureAd.ResetPasswordAsync(}
\DoxyCodeLine{\ \ \ \ LdapPasswordOptions.Create()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .ForUser(\textcolor{stringliteral}{"{}john.doe@contoso.com"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .WithNewPassword(\textcolor{stringliteral}{"{}Temp0rary123!"{}})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .MustChangeAtNextLogon());}

\end{DoxyCode}


{\bfseries{Required Microsoft Graph Permissions:\+}}


\begin{DoxyTable}{3}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Operation  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Application Permission  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Delegated Permission  \\
Enable/\+\+Disable Account  &User.\+Read\+Write.\+All  &User.\+Read\+Write  \\
Add/\+\+Remove from Group  &Group\+Member.\+Read\+Write.\+All  &Group\+Member.\+Read\+Write.\+All  \\
Reset Password  &User.\+Read\+Write.\+All  &-\/  \\
Force Password Change  &User.\+Read\+Write.\+All  &-\/  \\
Set Password Never Expires  &User.\+Read\+Write.\+All  &Directory.\+Access\+As\+User.\+All  \\
\end{DoxyTable}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md130}{}\doxysubsubsection{\texorpdfstring{Management Result}{Management Result}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md130}
All management operations return {\ttfamily Ldap\+Management\+Result}:\+


\begin{DoxyTable}{3}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Property  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Is\+Success}  &bool  &Whether operation succeeded  \\
{\ttfamily Operation}  &Ldap\+Management\+Operation  &Type of operation performed  \\
{\ttfamily Target\+Distinguished\+Name}  &string?  &DN of affected object  \\
{\ttfamily Details}  &string?  &Additional details or error message  \\
{\ttfamily Error\+Code}  &int?  &LDAP error code (if failed)  \\
\end{DoxyTable}



\begin{DoxyCode}{0}
\DoxyCodeLine{var\ result\ =\ await\ \_ldap.EnableAccountAsync(options);}
\DoxyCodeLine{\textcolor{keywordflow}{if}\ (result.IsSuccess)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \_logger.LogInformation(\textcolor{stringliteral}{"{}Enabled\ account:\ \{Dn\}"{}},\ result.TargetDistinguishedName);}
\DoxyCodeLine{\}}
\DoxyCodeLine{\textcolor{keywordflow}{else}}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \_logger.LogError(\textcolor{stringliteral}{"{}Failed:\ \{Details\}\ (Error:\ \{Code\})"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ result.Details,\ result.ErrorCode);}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md131}{}\doxysubsubsection{\texorpdfstring{Supported Operations by Directory Type}{Supported Operations by Directory Type}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md131}

\begin{DoxyTable}{5}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Operation  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Active Directory  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Open\+LDAP  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Apple Directory  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Azure AD  \\
Enable\+Account  &  &  &  &  \\
Disable\+Account  &  &  &  &  \\
Unlock\+Account  &  &  &  &  \\
Add\+To\+Group  &  &  &  &  \\
Remove\+From\+Group  &  &  &  &  \\
Move\+Object  &  &  &  &  \\
Rename\+Object  &  &  &  &  \\
Change\+Password  &  &  &  &  \\
Reset\+Password  &  &  &  &  \\
Force\+Password\+Change  &  &  &  &  \\
Set\+Password\+Never\+Expires  &  &  &  &  \\
\end{DoxyTable}


{\bfseries{Azure AD Notes:\+}}
\begin{DoxyEnumerate}
\item Azure AD uses Identity Protection for lockout management, not direct unlock
\item Azure AD has no concept of OUs; use Administrative Units for delegation
\item Password change requires delegated authentication flow (MSAL); use Reset\+Password for admin resets
\end{DoxyEnumerate}

Check supported operations programmatically:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ supported\ =\ \_ldap.GetSupportedManagementOperations();}
\DoxyCodeLine{\textcolor{keywordflow}{if}\ (supported.Contains(LdapManagementOperation.EnableAccount))}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Account\ enable/disable\ is\ supported}}
\DoxyCodeLine{\}}

\end{DoxyCode}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md133}{}\doxysection{\texorpdfstring{SSO Services}{SSO Services}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md133}
Single Sign-\/\+On services for session management, credential storage, and automatic token refresh.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md134}{}\doxysubsection{\texorpdfstring{Registration}{Registration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md134}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Extensions;}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Options;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Basic\ SSO\ services}}
\DoxyCodeLine{services.AddSsoServices();}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ With\ custom\ configuration}}
\DoxyCodeLine{services.AddSsoServices(}
\DoxyCodeLine{\ \ \ \ sso\ =>}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sso.DefaultSessionDuration\ =\ TimeSpan.FromHours(8);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sso.MaxSessionDuration\ =\ TimeSpan.FromDays(7);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sso.EnableAutoRefresh\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sso.RefreshThreshold\ =\ 0.8;\ \textcolor{comment}{//\ Refresh\ at\ 80\%\ of\ lifetime}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sso.MaxSessionsPerUser\ =\ 5;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sso.PersistSessions\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\ \ \ \ \},}
\DoxyCodeLine{\ \ \ \ credStore\ =>}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ credStore.Provider\ =\ CredentialStoreProvider.Auto;\ \textcolor{comment}{//\ Auto-\/detect\ platform}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ credStore.ApplicationName\ =\ \textcolor{stringliteral}{"{}MyApp"{}};}
\DoxyCodeLine{\ \ \ \ \});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ From\ configuration}}
\DoxyCodeLine{services.AddSsoServices(configuration);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md135}{}\doxysubsection{\texorpdfstring{Session Management}{Session Management}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md135}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }AuthController}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ISsoSessionManager\ \_sessionManager;}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ILdapService\ \_ldapService;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ AuthController(ISsoSessionManager\ sessionManager,\ ILdapService\ ldapService)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_sessionManager\ =\ sessionManager;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_ldapService\ =\ ldapService;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<SsoSession>\ LoginAsync(\textcolor{keywordtype}{string}\ username,\ \textcolor{keywordtype}{string}\ password)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Authenticate\ with\ LDAP}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ authResult\ =\ await\ \_ldapService.AuthenticateAsync(\textcolor{keyword}{new}\ LdapAuthenticationOptions}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Mode\ =\ LdapAuthenticationMode.Simple,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Username\ =\ username,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Password\ =\ password,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ IncludeGroups\ =\ \textcolor{keyword}{true}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!authResult.IsAuthenticated)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ AuthenticationException(authResult.ErrorMessage);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ SSO\ session}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_sessionManager.CreateSessionAsync(authResult,\ \_ldapService);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<SsoSession>\ LoginWithDeviceBindingAsync(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ username,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ password,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ deviceId,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ ipAddress,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ userAgent)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ authResult\ =\ await\ \_ldapService.AuthenticateAsync(\textcolor{keyword}{new}\ LdapAuthenticationOptions}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Mode\ =\ LdapAuthenticationMode.Simple,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Username\ =\ username,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Password\ =\ password}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!authResult.IsAuthenticated)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ AuthenticationException(authResult.ErrorMessage);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ session\ with\ device\ binding}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_sessionManager.CreateSessionAsync(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ authResult,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \_ldapService,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ deviceId,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ipAddress,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ userAgent);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<bool>\ ValidateSessionAsync(\textcolor{keywordtype}{string}\ sessionId)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ result\ =\ await\ \_sessionManager.ValidateSessionAsync(sessionId);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result.IsValid;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ LogoutAsync(\textcolor{keywordtype}{string}\ sessionId)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_sessionManager.RevokeSessionAsync(sessionId);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ LogoutAllDevicesAsync(\textcolor{keywordtype}{string}\ userId)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_sessionManager.RevokeAllUserSessionsAsync(userId);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ LogoutOtherDevicesAsync(\textcolor{keywordtype}{string}\ userId,\ \textcolor{keywordtype}{string}\ currentSessionId)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_sessionManager.RevokeOtherSessionsAsync(userId,\ currentSessionId);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md136}{}\doxysubsection{\texorpdfstring{Session Validation}{Session Validation}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md136}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }SessionMiddleware}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ISsoSessionManager\ \_sessionManager;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ SessionMiddleware(ISsoSessionManager\ sessionManager)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_sessionManager\ =\ sessionManager;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<SsoSessionValidationResult>\ ValidateAsync(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ sessionId,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}?\ deviceId\ =\ \textcolor{keyword}{null},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}?\ ipAddress\ =\ \textcolor{keyword}{null})}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ result\ =\ await\ \_sessionManager.ValidateSessionAsync(sessionId,\ deviceId,\ ipAddress);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!result.IsValid)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (result.FailureReason)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SsoValidationFailureReason.SessionNotFound:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Session\ doesn't\ exist}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SsoValidationFailureReason.SessionExpired:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Session\ has\ expired}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SsoValidationFailureReason.SessionRevoked:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Session\ was\ explicitly\ revoked}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SsoValidationFailureReason.DeviceMismatch:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Request\ from\ different\ device}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SsoValidationFailureReason.IpMismatch:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Request\ from\ different\ IP}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md137}{}\doxysubsection{\texorpdfstring{Session Events}{Session Events}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md137}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }SessionEventHandler}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ SessionEventHandler(ISsoSessionManager\ sessionManager)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sessionManager.SessionCreated\ +=\ OnSessionCreated;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sessionManager.SessionExpiring\ +=\ OnSessionExpiring;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sessionManager.SessionRefreshed\ +=\ OnSessionRefreshed;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sessionManager.SessionExpired\ +=\ OnSessionExpired;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sessionManager.SessionRevoked\ +=\ OnSessionRevoked;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ OnSessionCreated(\textcolor{keywordtype}{object}?\ sender,\ SsoSessionCreatedEventArgs\ e)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Session\ created:\ \{e.Session.SessionId\}\ for\ \{e.Session.UserId\}"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ OnSessionExpiring(\textcolor{keywordtype}{object}?\ sender,\ SsoSessionExpiringEventArgs\ e)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Session\ expiring\ in\ \{e.TimeToExpiry\}:\ \{e.Session.SessionId\}"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ OnSessionRefreshed(\textcolor{keywordtype}{object}?\ sender,\ SsoSessionRefreshedEventArgs\ e)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Session\ refreshed:\ \{e.Session.SessionId\},\ new\ expiry:\ \{e.NewExpiresAt\}"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ OnSessionExpired(\textcolor{keywordtype}{object}?\ sender,\ SsoSessionExpiredEventArgs\ e)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Session\ expired:\ \{e.SessionId\}"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ OnSessionRevoked(\textcolor{keywordtype}{object}?\ sender,\ SsoSessionRevokedEventArgs\ e)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Session\ revoked:\ \{e.SessionId\},\ reason:\ \{e.Reason\}"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md139}{}\doxysubsection{\texorpdfstring{Credential Storage}{Credential Storage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md139}
Secure credential storage with platform-\/specific implementations.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md140}{}\doxysubsubsection{\texorpdfstring{Providers}{Providers}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md140}

\begin{DoxyTable}{3}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Provider  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Platform  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Auto}  &All  &Auto-\/detect best provider  \\
{\ttfamily Windows\+Credential\+Manager}  &Windows  &Windows Credential Manager with DPAPI  \\
{\ttfamily Mac\+Os\+Keychain}  &mac\+OS  &mac\+OS Keychain Services (planned)  \\
{\ttfamily Linux\+Secret\+Service}  &Linux  &GNOME Keyring/\+\+KDE Wallet (planned)  \\
{\ttfamily Encrypted\+File}  &All  &AES-\/256-\/\+GCM encrypted JSON file  \\
{\ttfamily In\+Memory}  &All  &Non-\/persistent, for testing  \\
\end{DoxyTable}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md141}{}\doxysubsubsection{\texorpdfstring{Usage}{Usage}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md141}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }CredentialService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ICredentialStore\ \_credentialStore;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ CredentialService(ICredentialStore\ credentialStore)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_credentialStore\ =\ credentialStore;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ StoreTokenAsync(\textcolor{keywordtype}{string}\ userId,\ \textcolor{keywordtype}{string}\ accessToken,\ \textcolor{keywordtype}{string}\ refreshToken)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ credential\ =\ \textcolor{keyword}{new}\ SsoCredential}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ UserId\ =\ userId,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Type\ =\ CredentialType.AccessToken,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ AccessToken\ =\ accessToken,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ RefreshToken\ =\ refreshToken,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ExpiresAt\ =\ DateTimeOffset.UtcNow.AddHours(1),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ DirectoryType\ =\ LdapDirectoryType.ActiveDirectory}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_credentialStore.StoreCredentialAsync(\$\textcolor{stringliteral}{"{}token:\{userId\}"{}},\ credential);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<string?>\ GetTokenAsync(\textcolor{keywordtype}{string}\ userId)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ credential\ =\ await\ \_credentialStore.GetCredentialAsync(\$\textcolor{stringliteral}{"{}token:\{userId\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ credential?.AccessToken;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ RemoveTokenAsync(\textcolor{keywordtype}{string}\ userId)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_credentialStore.RemoveCredentialAsync(\$\textcolor{stringliteral}{"{}token:\{userId\}"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<IReadOnlyList<SsoCredential>>\ GetUserCredentialsAsync(\textcolor{keywordtype}{string}\ userId)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_credentialStore.GetUserCredentialsAsync(userId);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ CleanupExpiredAsync()}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ removed\ =\ await\ \_credentialStore.CleanupExpiredAsync();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Removed\ \{removed\}\ expired\ credentials"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md142}{}\doxysubsubsection{\texorpdfstring{Credential Store Options}{Credential Store Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md142}

\begin{DoxyTable}{4}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Option  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Default  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Provider}  &Credential\+Store\+Provider  &Auto  &Storage provider  \\
{\ttfamily Application\+Name}  &string  &"{}\+Toolbox"{}  &Application identifier for credentials  \\
{\ttfamily Fallback\+Store\+Path}  &string?  &null  &Path for encrypted file store  \\
{\ttfamily Use\+Os\+Keychain}  &bool  &true  &Prefer OS-\/native credential storage  \\
\end{DoxyTable}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md144}{}\doxysubsection{\texorpdfstring{Automatic Token Refresh}{Automatic Token Refresh}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md144}
The token refresh service automatically refreshes tokens before they expire.\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md145}{}\doxysubsubsection{\texorpdfstring{Configuration}{Configuration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md145}

\begin{DoxyCode}{0}
\DoxyCodeLine{services.AddSsoServices(sso\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ sso.EnableAutoRefresh\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\ \ \ \ sso.RefreshThreshold\ =\ 0.8;\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Refresh\ at\ 80\%\ of\ lifetime}}
\DoxyCodeLine{\ \ \ \ sso.RefreshCheckInterval\ =\ TimeSpan.FromMinutes(1);}
\DoxyCodeLine{\ \ \ \ sso.MaxRefreshRetries\ =\ 3;}
\DoxyCodeLine{\ \ \ \ sso.RefreshRetryDelay\ =\ TimeSpan.FromSeconds(5);}
\DoxyCodeLine{\ \ \ \ sso.UseExponentialBackoff\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\});}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md146}{}\doxysubsubsection{\texorpdfstring{Manual Refresh}{Manual Refresh}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md146}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }TokenService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ITokenRefreshService\ \_refreshService;}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ ISsoSessionManager\ \_sessionManager;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ TokenService(ITokenRefreshService\ refreshService,\ ISsoSessionManager\ sessionManager)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_refreshService\ =\ refreshService;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_sessionManager\ =\ sessionManager;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<SsoSession?>\ RefreshNowAsync(\textcolor{keywordtype}{string}\ sessionId)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Immediate\ refresh}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_refreshService.RefreshNowAsync(sessionId);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task<int>\ RefreshAllPendingAsync()}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Refresh\ all\ sessions\ that\ need\ it}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ \_refreshService.RefreshAllPendingAsync();}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{void}\ CheckStatus()}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Service\ running:\ \{\_refreshService.IsRunning\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Registered\ sessions:\ \{\_refreshService.RegisteredSessionCount\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Successful\ refreshes:\ \{\_refreshService.SuccessfulRefreshCount\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Failed\ refreshes:\ \{\_refreshService.FailedRefreshCount\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Last\ check:\ \{\_refreshService.LastCheckTime\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Next\ check:\ \{\_refreshService.NextCheckTime\}"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md147}{}\doxysubsubsection{\texorpdfstring{Refresh Events}{Refresh Events}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md147}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }RefreshEventHandler}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ RefreshEventHandler(ITokenRefreshService\ refreshService)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ refreshService.RefreshNeeded\ +=\ OnRefreshNeeded;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ refreshService.RefreshCompleted\ +=\ OnRefreshCompleted;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ refreshService.RefreshFailed\ +=\ OnRefreshFailed;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ OnRefreshNeeded(\textcolor{keywordtype}{object}?\ sender,\ TokenRefreshNeededEventArgs\ e)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Refresh\ needed\ for\ \{e.Session.SessionId\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}\ \ Elapsed:\ \{e.LifetimeElapsedPercent:P0\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}\ \ Time\ to\ expiry:\ \{e.TimeToExpiry\}"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ OnRefreshCompleted(\textcolor{keywordtype}{object}?\ sender,\ TokenRefreshCompletedEventArgs\ e)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Refresh\ completed\ for\ \{e.SessionId\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}\ \ New\ expiry:\ \{e.NewExpiresAt\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}\ \ Duration:\ \{e.RefreshDuration.TotalMilliseconds\}ms"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ OnRefreshFailed(\textcolor{keywordtype}{object}?\ sender,\ TokenRefreshFailedEventArgs\ e)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}Refresh\ failed\ for\ \{e.SessionId\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}\ \ Error:\ \{e.Exception.Message\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}\ \ Retry:\ \{e.RetryAttempt\}/\{e.MaxRetries\}"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Console.WriteLine(\$\textcolor{stringliteral}{"{}\ \ Will\ retry:\ \{e.WillRetry\}"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md148}{}\doxysubsection{\texorpdfstring{SSO Session Options}{SSO Session Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md148}

\begin{DoxyTable}{4}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Option  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Default  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Default\+Session\+Duration}  &Time\+Span  &8 hours  &Default session lifetime  \\
{\ttfamily Max\+Session\+Duration}  &Time\+Span  &7 days  &Maximum session lifetime  \\
{\ttfamily Sliding\+Expiration}  &Time\+Span?  &30 min  &Sliding expiration window  \\
{\ttfamily Refresh\+Threshold}  &double  &0.\+8  &Refresh at \% of lifetime  \\
{\ttfamily Refresh\+Check\+Interval}  &Time\+Span  &1 min  &Background check interval  \\
{\ttfamily Enable\+Auto\+Refresh}  &bool  &true  &Enable automatic refresh  \\
{\ttfamily Persist\+Sessions}  &bool  &true  &Persist sessions to store  \\
{\ttfamily Max\+Sessions\+Per\+User}  &int  &5  &Max concurrent sessions  \\
{\ttfamily Revoke\+Oldest\+On\+Max\+Reached}  &bool  &true  &Revoke oldest when max reached  \\
{\ttfamily Enforce\+Device\+Binding}  &bool  &false  &Require same device  \\
{\ttfamily Enforce\+Ip\+Binding}  &bool  &false  &Require same IP address  \\
\end{DoxyTable}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md150}{}\doxysection{\texorpdfstring{Creating Custom Services}{Creating Custom Services}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md150}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md151}{}\doxysubsection{\texorpdfstring{Synchronous Disposal}{Synchronous Disposal}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md151}
For services with synchronous cleanup:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Base;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }MyService\ :\ BaseDisposableService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ SomeResource\ \_resource;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ MyService(ILogger<MyService>\ logger)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ :\ base(\textcolor{stringliteral}{"{}MyService"{}},\ logger)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_resource\ =\ \textcolor{keyword}{new}\ SomeResource();}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{void}\ DoWork()}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ThrowIfDisposed();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }var\ activity\ =\ StartActivity();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ sw\ =\ Stopwatch.StartNew();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_resource.Process();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ RecordOperation(\textcolor{stringliteral}{"{}DoWork"{}},\ sw.ElapsedMilliseconds);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{protected}\ \textcolor{keyword}{override}\ \textcolor{keywordtype}{void}\ Dispose(\textcolor{keywordtype}{bool}\ disposing)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (disposing)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \_resource?.Dispose();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ base.Dispose(disposing);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md152}{}\doxysubsection{\texorpdfstring{Asynchronous Disposal}{Asynchronous Disposal}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md152}
For services with async resources:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Base;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keyword}{class\ }MyAsyncService\ :\ BaseAsyncDisposableService}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ readonly\ Stream\ \_stream;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ MyAsyncService(ILogger<MyAsyncService>\ logger)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ :\ base(\textcolor{stringliteral}{"{}MyAsyncService"{}},\ logger)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_stream\ =\ \textcolor{keyword}{new}\ FileStream(\textcolor{stringliteral}{"{}data.bin"{}},\ FileMode.OpenOrCreate);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ async\ Task\ ProcessAsync(CancellationToken\ ct\ =\ \textcolor{keywordflow}{default})}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ThrowIfDisposed();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }var\ activity\ =\ StartActivity();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ var\ sw\ =\ Stopwatch.StartNew();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_stream.WriteAsync(data,\ ct);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ RecordOperation(\textcolor{stringliteral}{"{}ProcessAsync"{}},\ sw.ElapsedMilliseconds);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{protected}\ \textcolor{keyword}{override}\ async\ ValueTask\ DisposeAsyncCore(CancellationToken\ ct)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ \_stream.DisposeAsync();}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md154}{}\doxysection{\texorpdfstring{Open\+Telemetry Integration}{Open\+Telemetry Integration}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md154}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md155}{}\doxysubsection{\texorpdfstring{Basic Tracing and Metrics}{Basic Tracing and Metrics}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md155}

\begin{DoxyCode}{0}
\DoxyCodeLine{builder.Services.AddToolboxOpenTelemetry(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.EnableTracing\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\ \ \ \ options.EnableMetrics\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\ \ \ \ options.ServiceName\ =\ \textcolor{stringliteral}{"{}MyApplication"{}};}
\DoxyCodeLine{\ \ \ \ options.ServiceVersion\ =\ \textcolor{stringliteral}{"{}1.0.0"{}};}
\DoxyCodeLine{\});}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md156}{}\doxysubsection{\texorpdfstring{OTLP Export}{OTLP Export}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md156}

\begin{DoxyCode}{0}
\DoxyCodeLine{builder.Services.AddToolboxOpenTelemetry(options\ =>}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ options.OtlpEndpoint\ =\ \textcolor{stringliteral}{"{}http://localhost:4317"{}};}
\DoxyCodeLine{\});}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md157}{}\doxysubsection{\texorpdfstring{Custom Instrumentation}{Custom Instrumentation}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md157}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }Toolbox.Core.Telemetry;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Start\ a\ custom\ activity}}
\DoxyCodeLine{\textcolor{keyword}{using\ }var\ activity\ =\ ToolboxActivitySource.StartActivity(\textcolor{stringliteral}{"{}CustomOperation"{}});}
\DoxyCodeLine{activity?.SetTag(\textcolor{stringliteral}{"{}custom.tag"{}},\ \textcolor{stringliteral}{"{}value"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Record\ metrics}}
\DoxyCodeLine{ToolboxMeter.RecordOperation(\textcolor{stringliteral}{"{}MyService"{}},\ \textcolor{stringliteral}{"{}CustomOp"{}},\ elapsedMs);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md158}{}\doxysubsection{\texorpdfstring{Available Metrics}{Available Metrics}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md158}

\begin{DoxyTable}{3}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Metric  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily toolbox.\+operations.\+count}  &Counter  &Total operations  \\
{\ttfamily toolbox.\+operations.\+duration}  &Histogram  &Operation duration (ms)  \\
{\ttfamily toolbox.\+disposals.\+count}  &Counter  &Service disposal events  \\
{\ttfamily toolbox.\+instances.\+active}  &Up\+Down\+Counter  &Active service instances  \\
{\ttfamily toolbox.\+crypto.\+encrypt.\+count}  &Counter  &Encryption operations  \\
{\ttfamily toolbox.\+crypto.\+decrypt.\+count}  &Counter  &Decryption operations  \\
{\ttfamily toolbox.\+crypto.\+data.\+size}  &Histogram  &Data size (bytes)  \\
{\ttfamily toolbox.\+filetransfer.\+upload.\+count}  &Counter  &File uploads  \\
{\ttfamily toolbox.\+filetransfer.\+download.\+count}  &Counter  &File downloads  \\
{\ttfamily toolbox.\+filetransfer.\+size}  &Histogram  &File size (bytes)  \\
{\ttfamily toolbox.\+filetransfer.\+errors.\+count}  &Counter  &File transfer errors  \\
{\ttfamily toolbox.\+mailing.\+sent.\+count}  &Counter  &Emails sent  \\
{\ttfamily toolbox.\+api.\+requests.\+count}  &Counter  &API requests  \\
{\ttfamily toolbox.\+sso.\+sessions.\+created}  &Counter  &SSO sessions created  \\
{\ttfamily toolbox.\+sso.\+sessions.\+expired}  &Counter  &SSO sessions expired  \\
{\ttfamily toolbox.\+sso.\+sessions.\+active}  &Up\+Down\+Counter  &Active SSO sessions  \\
{\ttfamily toolbox.\+sso.\+validations.\+count}  &Counter  &Session validations  \\
{\ttfamily toolbox.\+sso.\+refresh.\+count}  &Counter  &Token refreshes  \\
\end{DoxyTable}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md160}{}\doxysection{\texorpdfstring{Configuration Options}{Configuration Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md160}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md161}{}\doxysubsection{\texorpdfstring{Toolbox\+Options}{Toolbox\+Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md161}

\begin{DoxyTable}{4}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Option  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Default  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Enable\+Detailed\+Telemetry}  &bool  &false  &Enable detailed telemetry  \\
{\ttfamily Service\+Prefix}  &string?  &null  &Prefix for service names  \\
{\ttfamily Async\+Disposal\+Timeout}  &Time\+Span  &30s  &Timeout for async disposal  \\
\end{DoxyTable}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md162}{}\doxysubsection{\texorpdfstring{Toolbox\+Telemetry\+Options}{Toolbox\+Telemetry\+Options}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md162}

\begin{DoxyTable}{4}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Option  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Type  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Default  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}Description  \\
{\ttfamily Enable\+Tracing}  &bool  &true  &Enable distributed tracing  \\
{\ttfamily Enable\+Metrics}  &bool  &true  &Enable metrics collection  \\
{\ttfamily Enable\+Console\+Export}  &bool  &false  &Export to console  \\
{\ttfamily Otlp\+Endpoint}  &string?  &null  &OTLP collector endpoint  \\
{\ttfamily Service\+Name}  &string  &"{}\+Toolbox"{}  &Service name for telemetry  \\
{\ttfamily Service\+Version}  &string  &"{}1.\+0.\+0"{}  &Service version  \\
\end{DoxyTable}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md164}{}\doxysection{\texorpdfstring{Best Practices}{Best Practices}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md164}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md165}{}\doxysubsection{\texorpdfstring{1. Always Check Disposal State}{1. Always Check Disposal State}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md165}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ \textcolor{keywordtype}{void}\ DoWork()}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ ThrowIfDisposed();\ \ \textcolor{comment}{//\ Call\ this\ first}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ ...\ rest\ of\ method}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md166}{}\doxysubsection{\texorpdfstring{2. Use Activity Scopes for Tracing}{2. Use Activity Scopes for Tracing}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md166}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ async\ Task\ DoWorkAsync()}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{using\ }var\ activity\ =\ StartActivity();}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Activity\ automatically\ ends\ when\ scope\ exits}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md167}{}\doxysubsection{\texorpdfstring{3. Record Metrics for Performance}{3. Record Metrics for Performance}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md167}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ sw\ =\ Stopwatch.StartNew();}
\DoxyCodeLine{\textcolor{comment}{//\ ...\ operation}}
\DoxyCodeLine{RecordOperation(\textcolor{stringliteral}{"{}OperationName"{}},\ sw.ElapsedMilliseconds);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md168}{}\doxysubsection{\texorpdfstring{4. Handle Cancellation in Async Operations}{4. Handle Cancellation in Async Operations}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md168}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}\ async\ Task\ ProcessAsync(CancellationToken\ ct\ =\ \textcolor{keywordflow}{default})}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ ct.ThrowIfCancellationRequested();}
\DoxyCodeLine{\ \ \ \ await\ \_service.DoWorkAsync(ct);}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md169}{}\doxysubsection{\texorpdfstring{5. Use Appropriate Service Lifetimes}{5. Use Appropriate Service Lifetimes}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md169}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Singleton\ for\ stateless\ services}}
\DoxyCodeLine{services.AddSingleton<ICryptographyService,\ AesCryptographyService>();}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Scoped\ for\ per-\/request\ services}}
\DoxyCodeLine{services.AddScoped<IFileTransferService,\ SftpFileTransferService>();}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Transient\ for\ lightweight\ services}}
\DoxyCodeLine{services.AddTransient<IMailingService,\ SmtpMailingService>();}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md170}{}\doxysubsection{\texorpdfstring{6. Secure Credential Management}{6. Secure Credential Management}}\label{md__c_1_2_users_2micde_2_rider_projects_2_toolbox_2_u_s_a_g_e_autotoc_md170}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Use\ configuration/secrets,\ not\ hardcoded\ values}}
\DoxyCodeLine{services.AddSmtpMailing(configuration.GetSection(\textcolor{stringliteral}{"{}Mailing"{}}));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Or\ use\ Azure\ Key\ Vault,\ AWS\ Secrets\ Manager,\ etc.}}
\DoxyCodeLine{var\ password\ =\ await\ secretsClient.GetSecretAsync(\textcolor{stringliteral}{"{}smtp-\/password"{}});}

\end{DoxyCode}
 