<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="__base_disposable_service_8cs_source" xml:lang="en-US">
<title>BaseDisposableService.cs</title>
<indexterm><primary>C:/Users/micde/RiderProjects/Toolbox/src/Toolbox.Core/Base/BaseDisposableService.cs</primary></indexterm>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="__base_disposable_service_8cs_source_1l00001"/>00001 <emphasis role="comment">//&#32;@file&#32;BaseDisposableService.cs</emphasis>
<anchor xml:id="__base_disposable_service_8cs_source_1l00002"/>00002 <emphasis role="comment">//&#32;@brief&#32;Abstract&#32;base&#32;class&#32;for&#32;synchronously&#32;disposable&#32;services</emphasis>
<anchor xml:id="__base_disposable_service_8cs_source_1l00003"/>00003 <emphasis role="comment">//&#32;@details&#32;Implements&#32;thread-safe&#32;dispose&#32;pattern&#32;with&#32;telemetry&#32;integration</emphasis>
<anchor xml:id="__base_disposable_service_8cs_source_1l00004"/>00004 <emphasis role="comment">//&#32;@note&#32;Derive&#32;from&#32;this&#32;class&#32;for&#32;services&#32;that&#32;only&#32;need&#32;synchronous&#32;disposal</emphasis>
<anchor xml:id="__base_disposable_service_8cs_source_1l00005"/>00005 
<anchor xml:id="__base_disposable_service_8cs_source_1l00006"/>00006 <emphasis role="keyword">using&#32;</emphasis><link linkend="_namespace_toolbox_1_1_core_1_1_abstractions">Toolbox.Core.Abstractions</link>;
<anchor xml:id="__base_disposable_service_8cs_source_1l00007"/>00007 <emphasis role="keyword">using&#32;</emphasis><link linkend="_namespace_toolbox_1_1_core_1_1_telemetry">Toolbox.Core.Telemetry</link>;
<anchor xml:id="__base_disposable_service_8cs_source_1l00008"/>00008 
<anchor xml:id="__base_disposable_service_8cs_source_1l00009"/>00009 <emphasis role="keyword">namespace&#32;</emphasis><link linkend="_namespace_toolbox_1_1_core_1_1_base">Toolbox.Core.Base</link>;
<anchor xml:id="__base_disposable_service_8cs_source_1l00010"/>00010 
<anchor xml:id="__base_disposable_service_8cs_source_1l00027"/><link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service">00027</link> <emphasis role="keyword">public</emphasis>&#32;<emphasis role="keyword">abstract</emphasis>&#32;<emphasis role="keyword">class&#32;</emphasis><link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a70d80274845dd844928e00c3ab630ec0">BaseDisposableService</link>&#32;:&#32;<link linkend="_interface_toolbox_1_1_core_1_1_abstractions_1_1_i_disposable_service">IDisposableService</link>,&#32;<link linkend="_interface_toolbox_1_1_core_1_1_abstractions_1_1_i_instrumented_service">IInstrumentedService</link>
<anchor xml:id="__base_disposable_service_8cs_source_1l00028"/>00028 {
<anchor xml:id="__base_disposable_service_8cs_source_1l00029"/>00029 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Flag&#32;indicating&#32;disposal&#32;state&#32;(0&#32;=&#32;not&#32;disposed,&#32;1&#32;=&#32;disposed)</emphasis>
<anchor xml:id="__base_disposable_service_8cs_source_1l00030"/>00030 &#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;_disposed;
<anchor xml:id="__base_disposable_service_8cs_source_1l00031"/>00031 
<anchor xml:id="__base_disposable_service_8cs_source_1l00032"/>00032 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;The&#32;logger&#32;instance&#32;for&#32;this&#32;service</emphasis>
<anchor xml:id="__base_disposable_service_8cs_source_1l00033"/>00033 &#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;readonly&#32;ILogger&#32;_logger;
<anchor xml:id="__base_disposable_service_8cs_source_1l00034"/>00034 
<anchor xml:id="__base_disposable_service_8cs_source_1l00043"/><link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a70d80274845dd844928e00c3ab630ec0">00043</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">protected</emphasis>&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a70d80274845dd844928e00c3ab630ec0">BaseDisposableService</link>(<emphasis role="keywordtype">string</emphasis>&#32;serviceName,&#32;ILogger&#32;logger)
<anchor xml:id="__base_disposable_service_8cs_source_1l00044"/>00044 &#32;&#32;&#32;&#32;{
<anchor xml:id="__base_disposable_service_8cs_source_1l00045"/>00045 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a629b72dfa8c6b42881909f8336c0dcbe">ServiceName</link>&#32;=&#32;serviceName&#32;??&#32;<emphasis role="keywordflow">throw</emphasis>&#32;<emphasis role="keyword">new</emphasis>&#32;ArgumentNullException(nameof(serviceName));
<anchor xml:id="__base_disposable_service_8cs_source_1l00046"/>00046 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_logger&#32;=&#32;logger&#32;??&#32;<emphasis role="keywordflow">throw</emphasis>&#32;<emphasis role="keyword">new</emphasis>&#32;ArgumentNullException(nameof(logger));
<anchor xml:id="__base_disposable_service_8cs_source_1l00047"/>00047 
<anchor xml:id="__base_disposable_service_8cs_source_1l00048"/>00048 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ToolboxMeter.IncrementActiveInstances(<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a629b72dfa8c6b42881909f8336c0dcbe">ServiceName</link>);
<anchor xml:id="__base_disposable_service_8cs_source_1l00049"/>00049 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_logger.LogDebug(<emphasis role="stringliteral">&quot;Service&#32;{ServiceName}&#32;created&quot;</emphasis>,&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a629b72dfa8c6b42881909f8336c0dcbe">ServiceName</link>);
<anchor xml:id="__base_disposable_service_8cs_source_1l00050"/>00050 &#32;&#32;&#32;&#32;}
<anchor xml:id="__base_disposable_service_8cs_source_1l00051"/>00051 
<anchor xml:id="__base_disposable_service_8cs_source_1l00053"/><link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a629b72dfa8c6b42881909f8336c0dcbe">00053</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">string</emphasis>&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a629b72dfa8c6b42881909f8336c0dcbe">ServiceName</link>&#32;{&#32;<emphasis role="keyword">get</emphasis>;&#32;}
<anchor xml:id="__base_disposable_service_8cs_source_1l00054"/>00054 
<anchor xml:id="__base_disposable_service_8cs_source_1l00056"/><link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1af000ffed9733f0bc1b39998b081fe8e7">00056</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">bool</emphasis>&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1af000ffed9733f0bc1b39998b081fe8e7">IsDisposed</link>&#32;=&gt;&#32;Volatile.Read(ref&#32;_disposed)&#32;==&#32;1;
<anchor xml:id="__base_disposable_service_8cs_source_1l00057"/>00057 
<anchor xml:id="__base_disposable_service_8cs_source_1l00059"/><link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a0dd2f79ae2fbe7efd3ff6c4a373053f8">00059</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a0dd2f79ae2fbe7efd3ff6c4a373053f8">ActivitySource</link>&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a0dd2f79ae2fbe7efd3ff6c4a373053f8">ActivitySource</link>&#32;=&gt;&#32;ToolboxActivitySource.Instance;
<anchor xml:id="__base_disposable_service_8cs_source_1l00060"/>00060 
<anchor xml:id="__base_disposable_service_8cs_source_1l00062"/><link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a1a6603570442645f31abbcad1d225068">00062</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a1a6603570442645f31abbcad1d225068">Meter</link>&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a1a6603570442645f31abbcad1d225068">Meter</link>&#32;=&gt;&#32;ToolboxMeter.Instance;
<anchor xml:id="__base_disposable_service_8cs_source_1l00063"/>00063 
<anchor xml:id="__base_disposable_service_8cs_source_1l00071"/><link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a5bccf3c546513ac18851a08b1ad80d89">00071</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a5bccf3c546513ac18851a08b1ad80d89">Dispose</link>()
<anchor xml:id="__base_disposable_service_8cs_source_1l00072"/>00072 &#32;&#32;&#32;&#32;{
<anchor xml:id="__base_disposable_service_8cs_source_1l00073"/>00073 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a5bccf3c546513ac18851a08b1ad80d89">Dispose</link>(disposing:&#32;<emphasis role="keyword">true</emphasis>);
<anchor xml:id="__base_disposable_service_8cs_source_1l00074"/>00074 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;GC.SuppressFinalize(<emphasis role="keyword">this</emphasis>);
<anchor xml:id="__base_disposable_service_8cs_source_1l00075"/>00075 &#32;&#32;&#32;&#32;}
<anchor xml:id="__base_disposable_service_8cs_source_1l00076"/>00076 
<anchor xml:id="__base_disposable_service_8cs_source_1l00094"/><link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1abe66f7a1e36466851f1a3df7ce2cc51c">00094</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">protected</emphasis>&#32;<emphasis role="keyword">virtual</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1abe66f7a1e36466851f1a3df7ce2cc51c">Dispose</link>(<emphasis role="keywordtype">bool</emphasis>&#32;disposing)
<anchor xml:id="__base_disposable_service_8cs_source_1l00095"/>00095 &#32;&#32;&#32;&#32;{
<anchor xml:id="__base_disposable_service_8cs_source_1l00096"/>00096 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(Interlocked.Exchange(ref&#32;_disposed,&#32;1)&#32;==&#32;1)
<anchor xml:id="__base_disposable_service_8cs_source_1l00097"/>00097 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__base_disposable_service_8cs_source_1l00098"/>00098 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>;
<anchor xml:id="__base_disposable_service_8cs_source_1l00099"/>00099 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__base_disposable_service_8cs_source_1l00100"/>00100 
<anchor xml:id="__base_disposable_service_8cs_source_1l00101"/>00101 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(disposing)
<anchor xml:id="__base_disposable_service_8cs_source_1l00102"/>00102 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__base_disposable_service_8cs_source_1l00103"/>00103 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">using&#32;</emphasis>var&#32;activity&#32;=&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a0dd2f79ae2fbe7efd3ff6c4a373053f8">ActivitySource</link>.StartActivity($<emphasis role="stringliteral">&quot;{ServiceName}.Dispose&quot;</emphasis>);
<anchor xml:id="__base_disposable_service_8cs_source_1l00104"/>00104 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;activity?.SetTag(TelemetryConstants.Attributes.ServiceName,&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a629b72dfa8c6b42881909f8336c0dcbe">ServiceName</link>);
<anchor xml:id="__base_disposable_service_8cs_source_1l00105"/>00105 
<anchor xml:id="__base_disposable_service_8cs_source_1l00106"/>00106 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_logger.LogDebug(<emphasis role="stringliteral">&quot;Service&#32;{ServiceName}&#32;disposing&quot;</emphasis>,&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a629b72dfa8c6b42881909f8336c0dcbe">ServiceName</link>);
<anchor xml:id="__base_disposable_service_8cs_source_1l00107"/>00107 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ToolboxMeter.RecordDisposal(<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a629b72dfa8c6b42881909f8336c0dcbe">ServiceName</link>);
<anchor xml:id="__base_disposable_service_8cs_source_1l00108"/>00108 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__base_disposable_service_8cs_source_1l00109"/>00109 &#32;&#32;&#32;&#32;}
<anchor xml:id="__base_disposable_service_8cs_source_1l00110"/>00110 
<anchor xml:id="__base_disposable_service_8cs_source_1l00120"/><link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a773c264af63233c53c4a9974073753b5">00120</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">protected</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a773c264af63233c53c4a9974073753b5">ThrowIfDisposed</link>()
<anchor xml:id="__base_disposable_service_8cs_source_1l00121"/>00121 &#32;&#32;&#32;&#32;{
<anchor xml:id="__base_disposable_service_8cs_source_1l00122"/>00122 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ObjectDisposedException.ThrowIf(<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1af000ffed9733f0bc1b39998b081fe8e7">IsDisposed</link>,&#32;<emphasis role="keyword">this</emphasis>);
<anchor xml:id="__base_disposable_service_8cs_source_1l00123"/>00123 &#32;&#32;&#32;&#32;}
<anchor xml:id="__base_disposable_service_8cs_source_1l00124"/>00124 
<anchor xml:id="__base_disposable_service_8cs_source_1l00130"/><link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1ab9bb57dbeef02f41d313f0516d5ba9b4">00130</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">protected</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1ab9bb57dbeef02f41d313f0516d5ba9b4">RecordOperation</link>(<emphasis role="keywordtype">string</emphasis>&#32;operationName,&#32;<emphasis role="keywordtype">double</emphasis>&#32;durationMs)
<anchor xml:id="__base_disposable_service_8cs_source_1l00131"/>00131 &#32;&#32;&#32;&#32;{
<anchor xml:id="__base_disposable_service_8cs_source_1l00132"/>00132 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ToolboxMeter.RecordOperation(<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a629b72dfa8c6b42881909f8336c0dcbe">ServiceName</link>,&#32;operationName,&#32;durationMs);
<anchor xml:id="__base_disposable_service_8cs_source_1l00133"/>00133 &#32;&#32;&#32;&#32;}
<anchor xml:id="__base_disposable_service_8cs_source_1l00134"/>00134 
<anchor xml:id="__base_disposable_service_8cs_source_1l00142"/><link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a8cae6c0b80bf9525c1d3e5a0a23b5e29">00142</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">protected</emphasis>&#32;Activity?&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a8cae6c0b80bf9525c1d3e5a0a23b5e29">StartActivity</link>([CallerMemberName]&#32;<emphasis role="keywordtype">string</emphasis>&#32;operationName&#32;=&#32;<emphasis role="stringliteral">&quot;&quot;</emphasis>)
<anchor xml:id="__base_disposable_service_8cs_source_1l00143"/>00143 &#32;&#32;&#32;&#32;{
<anchor xml:id="__base_disposable_service_8cs_source_1l00144"/>00144 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;var&#32;activity&#32;=&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a0dd2f79ae2fbe7efd3ff6c4a373053f8">ActivitySource</link>.StartActivity($<emphasis role="stringliteral">&quot;{ServiceName}.{operationName}&quot;</emphasis>);
<anchor xml:id="__base_disposable_service_8cs_source_1l00145"/>00145 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;activity?.SetTag(TelemetryConstants.Attributes.ServiceName,&#32;<link linkend="_class_toolbox_1_1_core_1_1_base_1_1_base_disposable_service_1a629b72dfa8c6b42881909f8336c0dcbe">ServiceName</link>);
<anchor xml:id="__base_disposable_service_8cs_source_1l00146"/>00146 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;activity?.SetTag(TelemetryConstants.Attributes.OperationName,&#32;operationName);
<anchor xml:id="__base_disposable_service_8cs_source_1l00147"/>00147 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;activity;
<anchor xml:id="__base_disposable_service_8cs_source_1l00148"/>00148 &#32;&#32;&#32;&#32;}
<anchor xml:id="__base_disposable_service_8cs_source_1l00149"/>00149 }
</programlisting></section>
